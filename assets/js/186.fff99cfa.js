(window.webpackJsonp=window.webpackJsonp||[]).push([[186],{502:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"vmpeak-与-vmsize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vmpeak-与-vmsize"}},[s._v("#")]),s._v(" VMPeak 与 VMSize")]),s._v(" "),a("p",[s._v("在 Android 系统中，VMPeak 和 VMSize 是进程虚拟内存的相关指标，它们对于应用的内存管理和性能有直接影响。了解这些指标对于优化应用的内存使用、特别是在 32 位设备上的优化非常重要。")]),s._v(" "),a("ol",[a("li",[s._v("VMPeak 和 VMSize 的定义")])]),s._v(" "),a("ul",[a("li",[s._v("VMPeak: 进程所使用的虚拟内存的峰值值。这个值表示自进程启动以来，进程虚拟内存使用的最大值。")]),s._v(" "),a("li",[s._v("VMSize: 当前进程所使用的虚拟内存大小。它表示进程当前的虚拟内存使用量，包括代码、数据、堆和栈等。")])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("对进程的影响")])]),s._v(" "),a("ul",[a("li",[s._v("内存使用管理:VMPeak 和 VMSize 是进程内存使用的两个重要指标。过高的 VMSize 可能会导致系统内存不足，尤其在设备 RAM 本身较少时，这可能导致系统频繁进行内存交换(swap)或杀死其他后台进程。")]),s._v(" "),a("li",[s._v("性能影响: 高内存使用会影响应用和系统的整体性能。频繁的垃圾回收(GC)和内存管理开销会增加，导致应用响应变慢。")]),s._v(" "),a("li",[s._v("崩溃风险: 如果 VMPeak 超过系统允许的最大虚拟内存(尤其在 32 位设备上，这个上限通常是 4GB)，可能会导致内存分配失败，进而引起应用崩溃。")])]),s._v(" "),a("hr"),s._v(" "),a("RText",{attrs:{text:"虚拟地址空间的理论上限"}}),s._v(" "),a("p",[s._v("在 32 位系统上，虚拟地址空间的理论上限是 4 GB(2^32 字节)。但是，由于操作系统和硬件保留了部分地址空间，实际应用程序可用的虚拟地址空间会少于 4 GB。")]),s._v(" "),a("p",[s._v("详细分析")]),s._v(" "),a("ol",[a("li",[s._v("理论最大值:\n32 位地址空间可以表示 4,294,967,296 字节(4 GB)。")]),s._v(" "),a("li",[s._v("实际可用空间:\n内核空间: 在许多 32 位操作系统中，内核和操作系统会占用一部分地址空间。例如，Linux 通常将最高的 1 GB 地址空间保留给内核，这意味着用户态程序可以使用的地址空间大约是 3 GB。\n系统保留和硬件映射: 系统和硬件还会保留部分地址空间用于硬件设备的内存映射和其他用途。")])]),s._v(" "),a("h2",{attrs:{id:"查看-vmsize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-vmsize"}},[s._v("#")]),s._v(" 查看 VmSize")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 pid")]),s._v("\nadb shell "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("process_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 VmSize")]),s._v("\nadb shell "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/status "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" VmSize\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_32-位设备上的优化建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_32-位设备上的优化建议"}},[s._v("#")]),s._v(" 32 位设备上的优化建议")]),s._v(" "),a("p",[s._v("针对 32 位设备，内存限制更为严格，因为它们的虚拟地址空间有限(最大 4GB，但通常系统和其他应用占用一部分，因此实际可用远小于 4GB)。可以采取以下优化措施:")]),s._v(" "),a("p",[s._v("1.内存优化策略:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("减少内存使用: 优化代码，减少不必要的对象创建和资源加载，特别是大对象和图像资源。")])]),s._v(" "),a("li",[a("p",[s._v("使用高效数据结构: 选择合适的数据结构，避免使用过多的链表、哈希表等占用大量内存的数据结构。")]),s._v(" "),a("p",[s._v("2.资源管理:")])]),s._v(" "),a("li",[a("p",[s._v("按需加载: 使用按需加载技术，只在需要时加载资源。避免在启动时加载所有资源。")])]),s._v(" "),a("li",[a("p",[s._v("释放不需要的资源: 及时释放不再需要的资源，特别是大图片、音频和视频文件。")])]),s._v(" "),a("li",[a("p",[s._v("优化图像: 使用压缩图像格式(如 WebP)，并根据设备屏幕分辨率加载适当尺寸的图像。")]),s._v(" "),a("p",[s._v("3.内存分析工具:")])]),s._v(" "),a("li",[a("p",[s._v("使用 Android Profiler: 通过 Android Studio 提供的内存分析工具，监控应用的内存使用，查找和修复内存泄漏。")])]),s._v(" "),a("li",[a("p",[s._v("LeakCanary: 集成内存泄漏检测工具，如 LeakCanary，自动检测和报告内存泄漏。")]),s._v(" "),a("p",[s._v("4.优化代码:")])]),s._v(" "),a("li",[a("p",[s._v("减少全局变量和单例: 避免过多使用全局变量和单例，它们会在整个应用生命周期中占用内存。")])]),s._v(" "),a("li",[a("p",[s._v("优化算法: 确保算法的时间和空间复杂度最低，避免使用高复杂度的算法。")]),s._v(" "),a("p",[s._v("5.垃圾回收优化:")])]),s._v(" "),a("li",[a("p",[s._v("减少临时对象创建: 尽量减少临时对象的创建，减少垃圾回收的频率。")])]),s._v(" "),a("li",[a("p",[s._v("使用池化技术: 对于频繁使用的大对象，使用对象池(object pool)来重用对象，避免频繁的创建和销毁。")])])]),s._v(" "),a("p",[s._v("通过以上措施，可以有效降低 VMPeak 和 VMSize，从而减少崩溃风险，提升应用在 32 位设备上的性能和稳定性。")]),s._v(" "),a("h2",{attrs:{id:"base"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#base"}},[s._v("#")]),s._v(" base")]),s._v(" "),a("h3",{attrs:{id:"获取-cpu-abis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取-cpu-abis"}},[s._v("#")]),s._v(" 获取 CPU ABIS")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取支持的cpu abi，返回一个数组。如 ['arm64-v8a', 'armeabi-v7a', 'armeabi']")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SUPPORTED_ABIS")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设备的主要 CPU 架构，armeabi-v7a. 可以拿到运行时主CPU架构。 另外也可以通过 ApplicationInfo 对象拿")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CPU_ABI")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设备的次要 CPU 架构")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CPU_ABI2")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过 ApplicationInfo 对象拿")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PackageManager")]),s._v(" pm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPackageManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" packageName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPackageName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationInfo")]),s._v(" ai "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getApplicationInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("packageName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PackageManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET_META_DATA")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" supportedABIs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SDK_INT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION_CODES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LOLLIPOP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Field")]),s._v(" primaryCpuAbi "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getField")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"primaryCpuAbi"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        primaryCpuAbi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAccessible")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsyncPLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"primaryCpuAbi=%s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" primaryCpuAbi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Field")]),s._v(" secondaryCpuAbi "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getField")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secondaryCpuAbi"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        secondaryCpuAbi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAccessible")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsyncPLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secondaryCpuAbi=%s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" secondaryCpuAbi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("ul",[a("li",[a("code",[s._v('aapt dump badging your_apk_file.apk | grep "native-code"')]),s._v(": 查看 apk 是 32 位还是 64 位")]),s._v(" "),a("li",[a("code",[s._v('adb shell dumpsys package <package_name> | grep "cpuAbi"')]),s._v(": 通过 adb 查看架构， not worked")]),s._v(" "),a("li",[a("code",[s._v("adb shell getprop ro.product.cpu.abilist")]),s._v(": 查看系统支持的 cpu 架构")])])],1)}),[],!1,null,null,null);a.default=e.exports}}]);