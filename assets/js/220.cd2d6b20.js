(window.webpackJsonp=window.webpackJsonp||[]).push([[220],{536:function(s,t,a){"use strict";a.r(t);var n=a(4),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[t("a",{attrs:{href:"https://github.com/scrapinghub/splash",target:"_blank",rel:"noopener noreferrer"}},[s._v("Splash"),t("OutboundLink")],1),s._v(" is a javascript rendering service with an HTTP API. It's a lightweight browser with an HTTP API, implemented in Python 3 using Twisted and QT5.")])]),s._v(" "),t("p",[s._v("It's fast, lightweight and state-less which makes it easy to distribute.")]),s._v(" "),t("h2",{attrs:{id:"usage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[s._v("#")]),s._v(" usage")]),s._v(" "),t("p",[s._v("使用 Splash 可以通过以下步骤:")]),s._v(" "),t("ol",[t("li",[s._v("安装 Splash:")])]),s._v(" "),t("p",[s._v("首先, 你需要安装 Splash 服务。你可以使用 Docker 快速部署 Splash 服务, 也可以选择其他安装方式。以下是使用 Docker 的示例:")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull scrapinghub/splash\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8050")]),s._v(":8050 scrapinghub/splash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这将在本地的 8050 端口启动 Splash 服务。")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("安装 Splash SDK:")])]),s._v(" "),t("p",[s._v("Splash 提供了 Python 客户端 SDK, 你需要安装它:")]),s._v(" "),t("blockquote",[t("p",[s._v("scrapy-splash: Scrapy+Splash for JavaScript integration")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" scrapy-splash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("在 Scrapy 项目中配置 Splash:")])]),s._v(" "),t("p",[s._v("在 Scrapy 项目的 settings.py 文件中配置 Splash, 指定 Splash 服务器地址:")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("SPLASH_URL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:8050'")]),s._v("\nDUPEFILTER_CLASS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'scrapy_splash.SplashAwareDupeFilter'")]),s._v("\nHTTPCACHE_STORAGE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'scrapy_splash.SplashAwareFSCacheStorage'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("在 Scrapy Spider 中使用 Splash:")])]),s._v(" "),t("p",[s._v("在 Scrapy Spider 中, 你可以使用 SplashRequest 替代常规的 Request, 以便在 Splash 中渲染页面。示例:")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" scrapy\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" scrapy_splash "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" SplashRequest\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySpider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scrapy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Spider"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\nname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.com'")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start_requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://example.com'")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),s._v(" SplashRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            args"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wait'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等待2秒以确保页面加载完成")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在这里处理页面渲染后的结果")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以使用 response.xpath 选择器提取数据")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("配置 Splash 参数:")])]),s._v(" "),t("p",[s._v("你可以使用 args 参数来配置 Splash 的行为, 例如等待时间、JavaScript 脚本等。在上述示例中, 我们使用了 args={'wait': 2} 来等待 2 秒, 确保页面加载完整。")]),s._v(" "),t("ol",{attrs:{start:"6"}},[t("li",[s._v("启动 Scrapy:")])]),s._v(" "),t("p",[s._v("使用 scrapy crawl spider_name 命令启动 Scrapy 爬虫, Scrapy 会自动发送请求到 Splash, 等待渲染后返回页面内容。")]),s._v(" "),t("p",[s._v("Splash 具有更多功能和配置选项, 可以用于处理更复杂的情况, 例如执行 JavaScript 脚本、单击页面元素等。你可以在 Splash 的官方文档中找到更多详细信息: "),t("a",{attrs:{href:"https://splash.readthedocs.io/en/stable/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://splash.readthedocs.io/en/stable/index.html"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"script"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#script"}},[s._v("#")]),s._v(" script")]),s._v(" "),t("blockquote",[t("p",[s._v("Splash UI provides an easy way to try scripts: there is a code editor for Lua and a button to submit a script to execute. Visit "),t("a",{attrs:{href:"http://127.0.0.1:8050/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8050/"),t("OutboundLink")],1),s._v(" (or whatever host/port Splash is listening to). 参考 "),t("a",{attrs:{href:"https://splash.readthedocs.io/en/stable/scripting-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("scripting-tutorial"),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[s._v("#")]),s._v(" example")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("splash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("assert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("splash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("go")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("assert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("splash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    html "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" splash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    png "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" splash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("png")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    har "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" splash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("har")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nend\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("这段代码是一个 Lua 脚本, 用于在 Splash 中执行网页渲染和数据提取操作。Splash 是一个基于 WebKit 的轻量级浏览器, 用于呈现网页并提供网页信息提取的功能, 通常用于网页截图、页面渲染和数据抓取。")]),s._v(" "),t("p",[s._v("这个 Lua 脚本定义了一个名为 main 的函数, 该函数接受两个参数 splash 和 args。其中 splash 是 Splash 对象, 用于执行各种操作, args 则是一个包含传递参数的表。")]),s._v(" "),t("p",[s._v("在这个函数中, 首先使用 "),t("code",[s._v("splash:go(args.url)")]),s._v(" 方法打开指定的网址, 然后使用 "),t("code",[s._v("splash:wait(0.5)")]),s._v(" 方法等待一定时间(0.5 秒)。接着, 该函数返回一个包含三个键值对的表:")]),s._v(" "),t("ul",[t("li",[s._v("html: 包含当前页面的 HTML 内容。")]),s._v(" "),t("li",[s._v("png: 当前页面的截图(PNG 格式)。")]),s._v(" "),t("li",[s._v("har: 当前页面的 HAR(HTTP Archive)数据, 记录了页面加载过程中的网络请求和响应信息。")])]),s._v(" "),t("p",[s._v("这个脚本适用于在 Splash 中执行网页渲染并提取相关数据, 可以通过 Splash 的 API 将其与其他系统集成, 如 Scrapy 框架, 实现自动化的网页截图、数据抓取等操作。")]),s._v(" "),t("h2",{attrs:{id:"http-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-api"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"https://splash.readthedocs.io/en/stable/api.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http api"),t("OutboundLink")],1)]),s._v(" "),t("ul",[t("li",[t("code",[s._v("scrapy shell 'http://localhost:8050/render.html?url=http://example.com/page-with-javascript.html&timeout=10&wait=0.5'")]),s._v(": play with splash")]),s._v(" "),t("li",[t("code",[s._v("curl 'http://localhost:8050/render.html?url=http://domain.com/page-with-javascript.html&timeout=10&wait=0.5'")]),s._v(": curl example")])]),s._v(" "),t("h2",{attrs:{id:"link"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#link"}},[s._v("#")]),s._v(" link")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://pypi.org/project/scrapy-splash/",target:"_blank",rel:"noopener noreferrer"}},[s._v("pypi.org(scrapy-splash)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/scrapinghub/splash",target:"_blank",rel:"noopener noreferrer"}},[s._v("splash-github"),t("OutboundLink")],1),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/scrapy-plugins/scrapy-splash",target:"_blank",rel:"noopener noreferrer"}},[s._v("Using Splash with Scrapy"),t("OutboundLink")],1)])])]),s._v(" "),t("li",[t("a",{attrs:{href:"https://splash.readthedocs.io/en/stable/",target:"_blank",rel:"noopener noreferrer"}},[s._v("doc"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);