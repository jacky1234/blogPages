(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{541:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),t("p",[s._v("【问】我想做一个日志分析工具, 日志中包含了固定格式的很多行, 可以通过正则匹配到固定的行, 解析这些行获取事件信息, 事件信息有 3 要素 event pid ts, 分别代表事件名称, 事件的 pid 和发生的时间点。另外事件需要关联此次事件的配置信息, 这个配置信息在其他行中获取。\n最后我需要通过 pandas 分析。写出推荐的做法")]),s._v(" "),t("h2",{attrs:{id:"理论"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#理论"}},[s._v("#")]),s._v(" 理论")]),s._v(" "),t("p",[s._v("构建一个日志分析工具, 需要多个步骤来解决问题。以下是一种可能的推荐做法:")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("正则表达式匹配和数据提取")]),s._v(":")]),s._v(" "),t("p",[s._v("使用正则表达式匹配来识别和提取固定格式的日志行, 以获取事件信息(event、pid、ts)以及配置信息。将这些信息存储在一个数据结构中, 例如字典或列表。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("构建数据结构")]),s._v(":")]),s._v(" "),t("p",[s._v("创建一个数据结构来存储事件信息。可以考虑使用字典或列表, 其中每个条目包含事件的名称(event)、事件的 pid、发生的时间点(ts)以及关联的配置信息。将所有事件的信息存储在一个数据结构中, 以备后续处理。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("数据分析和转换")]),s._v(":")]),s._v(" "),t("p",[s._v("使用 Pandas 进行数据分析和转换。将数据结构转换为 Pandas DataFrame, 以便更轻松地进行查询和分析。在 DataFrame 中, 您可以执行各种操作, 如过滤、排序、分组、计算汇总统计信息等。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("分析和可视化")]),s._v(":")]),s._v(" "),t("p",[s._v("利用 Pandas 提供的功能, 进行事件信息的分析和可视化。您可以使用 Pandas 内置的功能来进行数据汇总、图表绘制, 以及各种数据分析操作。根据您的需求, 可以生成报告、图表或其他可视化输出。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("可扩展性")]),s._v(":")]),s._v(" "),t("p",[s._v("考虑将整个流程封装成一个可重复使用的工具或脚本。这将使您能够处理大量日志文件, 并可以随着需求的变化轻松扩展功能。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("错误处理和日志记录")]),s._v(":")]),s._v(" "),t("p",[s._v("添加适当的错误处理机制, 以处理不匹配的日志行或其他异常情况。同时, 记录日志以追踪处理过程中的事件, 以便排除问题或进行故障排除。")])])]),s._v(" "),t("p",[s._v("这个推荐做法的关键是将日志分析任务分解为多个步骤, 并使用适当的工具来完成每个步骤。正则表达式用于提取信息, Pandas 用于数据分析, 而模块化的结构可以使代码更容易维护和扩展。")]),s._v(" "),t("h2",{attrs:{id:"示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[s._v("#")]),s._v(" 示例")]),s._v(" "),t("p",[s._v("以下是一个简化的示例, 演示了如何使用 Python、正则表达式、Pandas 和模拟的日志数据来提取事件信息、配置信息, 并使用 Pandas 进行分析:")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" pandas "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" pd\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" re\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模拟的日志数据")]),s._v("\nlog_data "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\nEvent: EventA\nPid: 1\nTimestamp: 2023-09-19 10:00:00\n\nEvent: EventB\nPid: 2\nTimestamp: 2023-09-19 10:15:00\n\nConfig: ConfigA\nParam1: Value1\nParam2: Value2\n\nEvent: EventC\nPid: 3\nTimestamp: 2023-09-19 10:30:00\n\nConfig: ConfigB\nParam1: Value3\nParam2: Value4\n"""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用正则表达式匹配事件信息")]),s._v("\nevent_pattern "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" re"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("compile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("r'Event: (.+?)\\nPid: (\\d+)\\nTimestamp: (.+)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nevents "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event_pattern"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("findall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用正则表达式匹配配置信息")]),s._v("\nconfig_pattern "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" re"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("compile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("r'Config: (.+?)\\nParam1: (.+?)\\nParam2: (.+)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconfigs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" config_pattern"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("findall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 Pandas DataFrame")]),s._v("\nevent_df "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DataFrame"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" columns"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Event"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Pid"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Timestamp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconfig_df "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DataFrame"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("configs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" columns"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Param1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Param2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 合并事件信息和配置信息")]),s._v("\nresult_df "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event_df"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("merge"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config_df"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" how"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"left"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" left_on"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Event"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" right_on"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印结果")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result_df"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("p",[s._v("这个示例演示了如何从日志数据中提取事件信息和配置信息, 并将其组合成一个 Pandas DataFrame 以供进一步分析。您可以根据实际的日志数据和需求进行修改和扩展。")])])}),[],!1,null,null,null);t.default=e.exports}}]);