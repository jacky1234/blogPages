(window.webpackJsonp=window.webpackJsonp||[]).push([[233],{549:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"查询练习"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询练习"}},[s._v("#")]),s._v(" 查询练习")]),s._v(" "),n("h3",{attrs:{id:"准备数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备数据"}},[s._v("#")]),s._v(" 准备数据")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 创建数据库\nCREATE DATABASE select_test;\n-- 切换数据库\nUSE select_test;\n\n-- 创建学生表\nCREATE TABLE student (\n    no VARCHAR(20) PRIMARY KEY,\n    name VARCHAR(20) NOT NULL,\n    sex VARCHAR(10) NOT NULL,\n    birthday DATE, -- 生日\n    class VARCHAR(20) -- 所在班级\n);\n\n-- 创建教师表\nCREATE TABLE teacher (\n    no VARCHAR(20) PRIMARY KEY,\n    name VARCHAR(20) NOT NULL,\n    sex VARCHAR(10) NOT NULL,\n    birthday DATE,\n    profession VARCHAR(20) NOT NULL, -- 职称\n    department VARCHAR(20) NOT NULL -- 部门\n);\n\n-- 创建课程表\nCREATE TABLE course (\n    no VARCHAR(20) PRIMARY KEY,\n    name VARCHAR(20) NOT NULL,\n    t_no VARCHAR(20) NOT NULL, -- 教师编号\n    -- 表示该 tno 来自于 teacher 表中的 no 字段值\n    FOREIGN KEY(t_no) REFERENCES teacher(no)\n);\n\n-- 成绩表\nCREATE TABLE score (\n    s_no VARCHAR(20) NOT NULL, -- 学生编号\n    c_no VARCHAR(20) NOT NULL, -- 课程号\n    degree DECIMAL, -- 成绩\n    -- 表示该 s_no, c_no 分别来自于 student, course 表中的 no 字段值\n    FOREIGN KEY(s_no) REFERENCES student(no),\n    FOREIGN KEY(c_no) REFERENCES course(no),\n    -- 设置 s_no, c_no 为联合主键\n    PRIMARY KEY(s_no, c_no)\n);\n\n-- 查看所有表\nSHOW TABLES;\n\n-- 添加学生表数据\nINSERT INTO student VALUES('101', '曾华', '男', '1977-09-01', '95033');\nINSERT INTO student VALUES('102', '匡明', '男', '1975-10-02', '95031');\nINSERT INTO student VALUES('103', '王丽', '女', '1976-01-23', '95033');\nINSERT INTO student VALUES('104', '李军', '男', '1976-02-20', '95033');\nINSERT INTO student VALUES('105', '王芳', '女', '1975-02-10', '95031');\nINSERT INTO student VALUES('106', '陆军', '男', '1974-06-03', '95031');\nINSERT INTO student VALUES('107', '王尼玛', '男', '1976-02-20', '95033');\nINSERT INTO student VALUES('108', '张全蛋', '男', '1975-02-10', '95031');\nINSERT INTO student VALUES('109', '赵铁柱', '男', '1974-06-03', '95031');\n\n-- 添加教师表数据\nINSERT INTO teacher VALUES('804', '李诚', '男', '1958-12-02', '副教授', '计算机系');\nINSERT INTO teacher VALUES('856', '张旭', '男', '1969-03-12', '讲师', '电子工程系');\nINSERT INTO teacher VALUES('825', '王萍', '女', '1972-05-05', '助教', '计算机系');\nINSERT INTO teacher VALUES('831', '刘冰', '女', '1977-08-14', '助教', '电子工程系');\n\n-- 添加课程表数据\nINSERT INTO course VALUES('3-105', '计算机导论', '825');\nINSERT INTO course VALUES('3-245', '操作系统', '804');\nINSERT INTO course VALUES('6-166', '数字电路', '856');\nINSERT INTO course VALUES('9-888', '高等数学', '831');\n\n-- 添加添加成绩表数据\nINSERT INTO score VALUES('103', '3-105', '92');\nINSERT INTO score VALUES('103', '3-245', '86');\nINSERT INTO score VALUES('103', '6-166', '85');\nINSERT INTO score VALUES('105', '3-105', '88');\nINSERT INTO score VALUES('105', '3-245', '75');\nINSERT INTO score VALUES('105', '6-166', '79');\nINSERT INTO score VALUES('109', '3-105', '76');\nINSERT INTO score VALUES('109', '3-245', '68');\nINSERT INTO score VALUES('109', '6-166', '81');\n\n-- 查看表结构\nSELECT * FROM course;\nSELECT * FROM score;\nSELECT * FROM student;\nSELECT * FROM teacher;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br")])]),n("h3",{attrs:{id:"_1-到-10"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-到-10"}},[s._v("#")]),s._v(" 1 到 10")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 查询 student 表的所有行\nSELECT * FROM student;\n\n-- 查询 student 表中的 name、sex 和 class 字段的所有行\nSELECT name, sex, class FROM student;\n\n-- 查询 teacher 表中不重复的 department 列\n-- department: 去重查询\nSELECT DISTINCT department FROM teacher;\n\n-- 查询 score 表中成绩在60-80之间的所有行(区间查询和运算符查询)\n-- BETWEEN xx AND xx: 查询区间, AND 表示 \"并且\"\nSELECT * FROM score WHERE degree BETWEEN 60 AND 80;\nSELECT * FROM score WHERE degree > 60 AND degree < 80;\n\n-- 查询 score 表中成绩为 85, 86 或 88 的行\n-- IN: 查询规定中的多个值\nSELECT * FROM score WHERE degree IN (85, 86, 88);\n\n-- 查询 student 表中 '95031' 班或性别为 '女' 的所有行\n-- or: 表示或者关系\nSELECT * FROM student WHERE class = '95031' or sex = '女';\n\n-- 以 class 降序的方式查询 student 表的所有行\n-- DESC: 降序, 从高到低\n-- ASC(默认): 升序, 从低到高\nSELECT * FROM student ORDER BY class DESC;\nSELECT * FROM student ORDER BY class ASC;\n\n-- 以 c_no 升序、degree 降序查询 score 表的所有行\nSELECT * FROM score ORDER BY c_no ASC, degree DESC;\n\n-- 查询 \"95031\" 班的学生人数\n-- COUNT: 统计\nSELECT COUNT(*) FROM student WHERE class = '95031';\n\n-- 查询 score 表中的最高分的学生学号和课程编号(子查询或排序查询)。\n-- (SELECT MAX(degree) FROM score): 子查询, 算出最高分\nSELECT s_no, c_no FROM score WHERE degree = (SELECT MAX(degree) FROM score);\n\n--  排序查询\n-- LIMIT r, n: 表示从第r行开始, 查询n条数据\nSELECT s_no, c_no, degree FROM score ORDER BY degree DESC LIMIT 0, 1;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("h3",{attrs:{id:"分组计算平均成绩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分组计算平均成绩"}},[s._v("#")]),s._v(" 分组计算平均成绩")]),s._v(" "),n("blockquote",[n("p",[s._v("查询每门课的平均成绩")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- AVG: 平均值\nSELECT AVG(degree) FROM score WHERE c_no = '3-105';\nSELECT AVG(degree) FROM score WHERE c_no = '3-245';\nSELECT AVG(degree) FROM score WHERE c_no = '6-166';\n\n-- GROUP BY: 分组查询\nSELECT c_no, AVG(degree) FROM score GROUP BY c_no;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"分组条件与模糊查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分组条件与模糊查询"}},[s._v("#")]),s._v(" 分组条件与模糊查询")]),s._v(" "),n("blockquote",[n("p",[s._v("查询 "),n("code",[s._v("score")]),s._v(" 表中至少有 2 名学生选修, 并以 3 开头的课程的平均分数。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM score;\n\n-- s_no 学生id\n-- c_no 课程编号\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 103 : 3-105:     92\n- 103 : 3-245:     86\n- 103 : 6-166:     85\n- 105 : 3-105:     88\n- 105 : 3-245:     75\n- 105 : 6-166:     79\n- 109 : 3-105:     76\n- 109 : 3-245:     68\n- 109 : 6-166:     81\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("分析表发现, 至少有 2 名学生选修的课程是 "),n("code",[s._v("3-105")]),s._v(" 、"),n("code",[s._v("3-245")]),s._v(" 、"),n("code",[s._v("6-166")]),s._v(" , 以 3 开头的课程是 "),n("code",[s._v("3-105")]),s._v(" 、"),n("code",[s._v("3-245")]),s._v(" 。也就是说, 我们要查询所有 "),n("code",[s._v("3-105")]),s._v(" 和 "),n("code",[s._v("3-245")]),s._v(" 的 "),n("code",[s._v("degree")]),s._v(" 平均分。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 首先把 c_no, AVG(degree) 通过分组查询出来\nSELECT c_no, AVG(degree) FROM score GROUP BY c_no\n+-------+-------------+\n- c_no : AVG(degree)\n+-------+-------------+\n- 3-105:     85.3333\n- 3-245:     76.3333\n- 6-166:     81.6667\n+-------+-------------+\n\n-- 再查询出至少有 2 名学生选修的课程\n-- HAVING: 表示持有\nHAVING COUNT(c_no) >= 2\n\n-- 并且是以 3 开头的课程\n-- LIKE 表示模糊查询, \"%\" 是一个通配符, 匹配 \"3\" 后面的任意字符。\nAND c_no LIKE '3%';\n\n-- 把前面的SQL语句拼接起来,\n-- 后面加上一个 COUNT(*), 表示将每个分组的个数也查询出来。\n\nSELECT c_no, AVG(degree), COUNT(*) FROM score GROUP BY c_no\nHAVING COUNT(c_no) >= 2 AND c_no LIKE '3%';\n+-------+-------------+----------+\n- c_no : AVG(degree): COUNT(*)\n+-------+-------------+----------+\n- 3-105:     85.3333:        3\n- 3-245:     76.3333:        3\n+-------+-------------+----------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("h3",{attrs:{id:"多表查询-1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多表查询-1"}},[s._v("#")]),s._v(" 多表查询-1")]),s._v(" "),n("blockquote",[n("p",[s._v("查询所有学生的 "),n("code",[s._v("name")]),s._v(", 以及该学生在 "),n("code",[s._v("score")]),s._v(" 表中对应的 "),n("code",[s._v("c_no")]),s._v(" 和 "),n("code",[s._v("degree")])])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT no, name FROM student;\n+-----+-----------+\n- no : name\n+-----+-----------+\n- 101: 曾华\n- 102: 匡明\n- 103: 王丽\n- 104: 李军\n- 105: 王芳\n- 106: 陆军\n- 107: 王尼玛\n- 108: 张全蛋\n- 109: 赵铁柱\n+-----+-----------+\n\nSELECT s_no, c_no, degree FROM score;\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 103 : 3-105:     92\n- 103 : 3-245:     86\n- 103 : 6-166:     85\n- 105 : 3-105:     88\n- 105 : 3-245:     75\n- 105 : 6-166:     79\n- 109 : 3-105:     76\n- 109 : 3-245:     68\n- 109 : 6-166:     81\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("通过分析可以发现, 只要把 "),n("code",[s._v("score")]),s._v(" 表中的 "),n("code",[s._v("s_no")]),s._v(" 字段值替换成 "),n("code",[s._v("student")]),s._v(" 表中对应的 "),n("code",[s._v("name")]),s._v(" 字段值就可以了, 如何做呢？")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- FROM...: 表示从 student, score 表中查询\n-- WHERE 的条件表示为, 只有在 student.no 和 score.s_no 相等时才显示出来。\n\nSELECT name, c_no, degree FROM student, score\nWHERE student.no = score.s_no;\n+-----------+-------+--------+\n- name     : c_no : degree\n+-----------+-------+--------+\n- 王丽     : 3-105:     92\n- 王丽     : 3-245:     86\n- 王丽     : 6-166:     85\n- 王芳     : 3-105:     88\n- 王芳     : 3-245:     75\n- 王芳     : 6-166:     79\n- 赵铁柱   : 3-105:     76\n- 赵铁柱   : 3-245:     68\n- 赵铁柱   : 6-166:     81\n+-----------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"多表查询-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多表查询-2"}},[s._v("#")]),s._v(" 多表查询-2")]),s._v(" "),n("blockquote",[n("p",[s._v("查询所有学生的 "),n("code",[s._v("no")]),s._v(" 、课程名称 ( "),n("code",[s._v("course")]),s._v(" 表中的 "),n("code",[s._v("name")]),s._v(" ) 和成绩 ( "),n("code",[s._v("score")]),s._v(" 表中的 "),n("code",[s._v("degree")]),s._v(" ) 列.")])]),s._v(" "),n("p",[s._v("只有 "),n("code",[s._v("score")]),s._v(" 关联学生的 "),n("code",[s._v("no")]),s._v(" , 因此只要查询 "),n("code",[s._v("score")]),s._v(" 表, 就能找出所有和学生相关的 "),n("code",[s._v("no")]),s._v(" 和 "),n("code",[s._v("degree")]),s._v(" :")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT s_no, c_no, degree FROM score;\n\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 103 : 3-105:     92\n- 103 : 3-245:     86\n- 103 : 6-166:     85\n- 105 : 3-105:     88\n- 105 : 3-245:     75\n- 105 : 6-166:     79\n- 109 : 3-105:     76\n- 109 : 3-245:     68\n- 109 : 6-166:     81\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("然后查询 "),n("code",[s._v("course")]),s._v(" 表:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("+-------+-----------------+\n- no   : name\n+-------+-----------------+\n- 3-105: 计算机导论\n- 3-245: 操作系统\n- 6-166: 数字电路\n- 9-888: 高等数学\n+-------+-----------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("只要把 "),n("code",[s._v("score")]),s._v(" 表中的 "),n("code",[s._v("c_no")]),s._v(" 替换成 "),n("code",[s._v("course")]),s._v(" 表中对应的 "),n("code",[s._v("name")]),s._v(" 字段值就可以了。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 增加一个查询字段 name, 分别从 score、course 这两个表中查询。\n-- as 表示取一个该字段的别名。\n\nSELECT s_no, name as c_name, degree FROM score, course\nWHERE score.c_no = course.no;\n+------+-----------------+--------+\n- s_no: c_name         : degree\n+------+-----------------+--------+\n- 103 : 计算机导论     :     92\n- 105 : 计算机导论     :     88\n- 109 : 计算机导论     :     76\n- 103 : 操作系统       :     86\n- 105 : 操作系统       :     75\n- 109 : 操作系统       :     68\n- 103 : 数字电路       :     85\n- 105 : 数字电路       :     79\n- 109 : 数字电路       :     81\n+------+-----------------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"三表关联查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三表关联查询"}},[s._v("#")]),s._v(" 三表关联查询")]),s._v(" "),n("blockquote",[n("p",[s._v("查询所有学生的 "),n("code",[s._v("name")]),s._v(" 、课程名 ( "),n("code",[s._v("course")]),s._v(" 表中的 "),n("code",[s._v("name")]),s._v(" ) 和 "),n("code",[s._v("degree")]),s._v(" 。")])]),s._v(" "),n("p",[n("strong",[s._v("分析")])]),s._v(" "),n("p",[s._v("只有 "),n("code",[s._v("score")]),s._v(" 表中关联学生的学号和课堂号, 我们只要围绕着 "),n("code",[s._v("score")]),s._v(" 这张表查询就好了。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM score;\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 103 : 3-105:     92\n- 103 : 3-245:     86\n- 103 : 6-166:     85\n- 105 : 3-105:     88\n- 105 : 3-245:     75\n- 105 : 6-166:     79\n- 109 : 3-105:     76\n- 109 : 3-245:     68\n- 109 : 6-166:     81\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("只要把 "),n("code",[s._v("s_no")]),s._v(" 和 "),n("code",[s._v("c_no")]),s._v(" 替换成 "),n("code",[s._v("student")]),s._v(" 和 "),n("code",[s._v("course")]),s._v(" 表中对应的 "),n("code",[s._v("name")]),s._v(" 字段值就好了。")]),s._v(" "),n("p",[s._v("首先把 "),n("code",[s._v("s_no")]),s._v(" 替换成 "),n("code",[s._v("student")]),s._v(" 表中的 "),n("code",[s._v("name")]),s._v(" 字段:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT name, c_no, degree FROM student, score WHERE student.no = score.s_no;\n+-----------+-------+--------+\n- name     : c_no : degree\n+-----------+-------+--------+\n- 王丽     : 3-105:     92\n- 王丽     : 3-245:     86\n- 王丽     : 6-166:     85\n- 王芳     : 3-105:     88\n- 王芳     : 3-245:     75\n- 王芳     : 6-166:     79\n- 赵铁柱   : 3-105:     76\n- 赵铁柱   : 3-245:     68\n- 赵铁柱   : 6-166:     81\n+-----------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("再把 "),n("code",[s._v("c_no")]),s._v(" 替换成 "),n("code",[s._v("course")]),s._v(" 表中的 "),n("code",[s._v("name")]),s._v(" 字段:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('-- 课程表\nSELECT no, name FROM course;\n+-------+-----------------+\n- no   : name\n+-------+-----------------+\n- 3-105: 计算机导论\n- 3-245: 操作系统\n- 6-166: 数字电路\n- 9-888: 高等数学\n+-------+-----------------+\n\n-- 由于字段名存在重复, 使用 "表名.字段名 as 别名" 代替。\n\nSELECT student.name as s_name, course.name as c_name, degree\nFROM student, score, course\nWHERE student.NO = score.s_no\nAND score.c_no = course.no;\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"子查询加分组求平均分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询加分组求平均分"}},[s._v("#")]),s._v(" 子查询加分组求平均分")]),s._v(" "),n("blockquote",[n("p",[s._v("查询 "),n("code",[s._v("95031")]),s._v(" 班学生每门课程的平均成绩")])]),s._v(" "),n("p",[s._v("在 "),n("code",[s._v("score")]),s._v(" 表中根据 "),n("code",[s._v("student")]),s._v(" 表的学生编号筛选出学生的课堂号和成绩:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- IN (..): 将筛选出的学生号当做 s_no 的条件查询\nSELECT s_no, c_no, degree FROM score\nWHERE s_no IN (SELECT no FROM student WHERE class = '95031');\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 105 : 3-105:     88\n- 105 : 3-245:     75\n- 105 : 6-166:     79\n- 109 : 3-105:     76\n- 109 : 3-245:     68\n- 109 : 6-166:     81\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("这时只要将 "),n("code",[s._v("c_no")]),s._v(" 分组一下就能得出 "),n("code",[s._v("95031")]),s._v(" 班学生每门课的平均成绩:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT c_no, AVG(degree) FROM score\nWHERE s_no IN (SELECT no FROM student WHERE class = '95031')\nGROUP BY c_no;\n+-------+-------------+\n- c_no : AVG(degree)\n+-------+-------------+\n- 3-105:     82.0000\n- 3-245:     71.5000\n- 6-166:     80.0000\n+-------+-------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"子查询-1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询-1"}},[s._v("#")]),s._v(" 子查询 - 1")]),s._v(" "),n("p",[n("strong",[s._v("查询在 "),n("code",[s._v("3-105")]),s._v(" 课程中, 所有成绩高于 "),n("code",[s._v("109")]),s._v(" 号同学的记录。")])]),s._v(" "),n("p",[s._v("首先筛选出课堂号为 "),n("code",[s._v("3-105")]),s._v(" , 在找出所有成绩高于 "),n("code",[s._v("109")]),s._v(" 号同学的的行。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM score\nWHERE c_no = '3-105'\nAND degree > (SELECT degree FROM score WHERE s_no = '109' AND c_no = '3-105');\n------------\n+------+-------+--------+\n| s_no | c_no  | degree |\n+------+-------+--------+\n| 103  | 3-105 |     92 |\n| 105  | 3-105 |     88 |\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"子查询-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询-2"}},[s._v("#")]),s._v(" 子查询 - 2")]),s._v(" "),n("p",[n("strong",[s._v("查询所有成绩高于 "),n("code",[s._v("109")]),s._v(" 号同学的 "),n("code",[s._v("3-105")]),s._v(" 课程成绩记录。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 不限制课程号, 只要成绩大于109号同学的3-105课程成绩就可以。\nSELECT * FROM score\nWHERE degree > (SELECT degree FROM score WHERE s_no = '109' AND c_no = '3-105');\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"year-函数与带-in-关键字查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#year-函数与带-in-关键字查询"}},[s._v("#")]),s._v(" YEAR 函数与带 IN 关键字查询")]),s._v(" "),n("p",[n("strong",[s._v("查询所有和 "),n("code",[s._v("101")]),s._v(" 、"),n("code",[s._v("108")]),s._v(" 号学生同年出生的 "),n("code",[s._v("no")]),s._v(" 、"),n("code",[s._v("name")]),s._v(" 、"),n("code",[s._v("birthday")]),s._v(" 列。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- YEAR(..): 取出日期中的年份\nSELECT no, name, birthday FROM student\nWHERE YEAR(birthday) IN (SELECT YEAR(birthday) FROM student WHERE no IN (101, 108));\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"多层嵌套子查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多层嵌套子查询"}},[s._v("#")]),s._v(" 多层嵌套子查询")]),s._v(" "),n("p",[n("strong",[s._v("查询 "),n("code",[s._v("'张旭'")]),s._v(" 教师任课的学生成绩表。")])]),s._v(" "),n("p",[s._v("首先找到教师编号:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT NO FROM teacher WHERE NAME = '张旭'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("通过 "),n("code",[s._v("course")]),s._v(" 表找到该教师课程号:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT NO FROM course WHERE t_no = ( SELECT NO FROM teacher WHERE NAME = '张旭' );\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("通过筛选出的课程号查询成绩表:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM score WHERE c_no = (\n    SELECT no FROM course WHERE t_no = (\n        SELECT no FROM teacher WHERE NAME = '张旭'\n    )\n);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"多表查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多表查询"}},[s._v("#")]),s._v(" 多表查询")]),s._v(" "),n("p",[n("strong",[s._v("查询某选修课程多于 5 个同学的教师姓名。")])]),s._v(" "),n("p",[s._v("首先在 "),n("code",[s._v("teacher")]),s._v(" 表中, 根据 "),n("code",[s._v("no")]),s._v(" 字段来判断该教师的同一门课程是否有至少 5 名学员选修:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 查询 teacher 表\nSELECT no, name FROM teacher;\n+-----+--------+\n- no : name\n+-----+--------+\n- 804: 李诚\n- 825: 王萍\n- 831: 刘冰\n- 856: 张旭\n+-----+--------+\n\nSELECT name FROM teacher WHERE no IN (\n    -- 在这里找到对应的条件\n);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("查看和教师编号有有关的表的信息:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM course;\n-- t_no: 教师编号\n+-------+-----------------+------+\n- no   : name           : t_no\n+-------+-----------------+------+\n- 3-105: 计算机导论     : 825\n- 3-245: 操作系统       : 804\n- 6-166: 数字电路       : 856\n- 9-888: 高等数学       : 831\n+-------+-----------------+------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("我们已经找到和教师编号有关的字段就在 "),n("code",[s._v("course")]),s._v(" 表中, 但是还无法知道哪门课程至少有 5 名学生选修, 所以还需要根据 "),n("code",[s._v("score")]),s._v(" 表来查询:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 在此之前向 score 插入一些数据, 以便丰富查询条件。\nINSERT INTO score VALUES ('101', '3-105', '90');\nINSERT INTO score VALUES ('102', '3-105', '91');\nINSERT INTO score VALUES ('104', '3-105', '89');\n\n-- 查询 score 表\nSELECT * FROM score;\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 101 : 3-105:     90\n- 102 : 3-105:     91\n- 103 : 3-105:     92\n- 103 : 3-245:     86\n- 103 : 6-166:     85\n- 104 : 3-105:     89\n- 105 : 3-105:     88\n- 105 : 3-245:     75\n- 105 : 6-166:     79\n- 109 : 3-105:     76\n- 109 : 3-245:     68\n- 109 : 6-166:     81\n+------+-------+--------+\n\n-- 在 score 表中将 c_no 作为分组, 并且限制 c_no 持有至少 5 条数据。\nSELECT c_no FROM score GROUP BY c_no HAVING COUNT(*) > 5;\n+-------+\n- c_no\n+-------+\n- 3-105\n+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("p",[s._v("根据筛选出来的课程号, 找出在某课程中, 拥有至少 5 名学员的教师编号:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT t_no FROM course WHERE no IN (\n    SELECT c_no FROM score GROUP BY c_no HAVING COUNT(*) > 5\n);\n+------+\n- t_no\n+------+\n- 825\n+------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("在 "),n("code",[s._v("teacher")]),s._v(" 表中, 根据筛选出来的教师编号找到教师姓名:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT name FROM teacher WHERE no IN (\n    -- 最终条件\n    SELECT t_no FROM course WHERE no IN (\n        SELECT c_no FROM score GROUP BY c_no HAVING COUNT(*) > 5\n    )\n);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"子查询-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询-3"}},[s._v("#")]),s._v(" 子查询 - 3")]),s._v(" "),n("p",[n("strong",[s._v('查询 "计算机系" 课程的成绩表。')])]),s._v(" "),n("p",[s._v("思路是, 先找出 "),n("code",[s._v("course")]),s._v(" 表中所有 "),n("code",[s._v("计算机系")]),s._v(" 课程的编号, 然后根据这个编号查询 "),n("code",[s._v("score")]),s._v(" 表。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 通过 teacher 表查询所有 `计算机系` 的教师编号\nSELECT no, name, department FROM teacher WHERE department = '计算机系'\n+-----+--------+--------------+\n- no : name  : department\n+-----+--------+--------------+\n- 804: 李诚  : 计算机系\n- 825: 王萍  : 计算机系\n+-----+--------+--------------+\n\n-- 通过 course 表查询该教师的课程编号\nSELECT no FROM course WHERE t_no IN (\n    SELECT no FROM teacher WHERE department = '计算机系'\n);\n+-------+\n- no\n+-------+\n- 3-245\n- 3-105\n+-------+\n\n-- 根据筛选出来的课程号查询成绩表\nSELECT * FROM score WHERE c_no IN (\n    SELECT no FROM course WHERE t_no IN (\n        SELECT no FROM teacher WHERE department = '计算机系'\n    )\n);\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 103 : 3-245:     86\n- 105 : 3-245:     75\n- 109 : 3-245:     68\n- 101 : 3-105:     90\n- 102 : 3-105:     91\n- 103 : 3-105:     92\n- 104 : 3-105:     89\n- 105 : 3-105:     88\n- 109 : 3-105:     76\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("h3",{attrs:{id:"union-和-not-in-的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#union-和-not-in-的使用"}},[s._v("#")]),s._v(" UNION 和 NOT IN 的使用")]),s._v(" "),n("p",[n("strong",[s._v("查询 "),n("code",[s._v("计算机系")]),s._v(" 与 "),n("code",[s._v("电子工程系")]),s._v(" 中的不同职称的教师。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- NOT: 代表逻辑非\nSELECT * FROM teacher WHERE department = '计算机系' AND profession NOT IN (\n    SELECT profession FROM teacher WHERE department = '电子工程系'\n)\n\n-- 合并两个集\nUNION\nSELECT * FROM teacher WHERE department = '电子工程系' AND profession NOT IN (\n    SELECT profession FROM teacher WHERE department = '计算机系'\n);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"any-表示至少一个"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#any-表示至少一个"}},[s._v("#")]),s._v(" ANY 表示至少一个")]),s._v(" "),n("p",[n("strong",[s._v("查询课程 "),n("code",[s._v("3-105")]),s._v(" 且成绩至少高于 "),n("code",[s._v("3-245")]),s._v(" 的 "),n("code",[s._v("score")]),s._v(" 表。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM score WHERE c_no = '3-105';\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 101 : 3-105:     90\n- 102 : 3-105:     91\n- 103 : 3-105:     92\n- 104 : 3-105:     89\n- 105 : 3-105:     88\n- 109 : 3-105:     76\n+------+-------+--------+\n\nSELECT * FROM score WHERE c_no = '3-245';\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 103 : 3-245:     86\n- 105 : 3-245:     75\n- 109 : 3-245:     68\n+------+-------+--------+\n\n-- ANY: 符合SQL语句中的任意条件。\n-- 也就是说, 在 3-105 成绩中, 只要有一个大于从 3-245 筛选出来的任意行就符合条件,\n-- 最后根据降序查询结果。\n\nSELECT * FROM score WHERE c_no = '3-105' AND degree > ANY(\n    SELECT degree FROM score WHERE c_no = '3-245'\n) ORDER BY degree DESC;\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 103 : 3-105:     92\n- 102 : 3-105:     91\n- 101 : 3-105:     90\n- 104 : 3-105:     89\n- 105 : 3-105:     88\n- 109 : 3-105:     76\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("h3",{attrs:{id:"表示所有的-all"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表示所有的-all"}},[s._v("#")]),s._v(" 表示所有的 ALL")]),s._v(" "),n("p",[n("strong",[s._v("查询课程 "),n("code",[s._v("3-105")]),s._v(" 且成绩高于 "),n("code",[s._v("3-245")]),s._v(" 的 "),n("code",[s._v("score")]),s._v(" 表。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 只需对上一道题稍作修改。\n-- ALL: 符合SQL语句中的所有条件。\n-- 也就是说, 在 3-105 每一行成绩中, 都要大于从 3-245 筛选出来全部行才算符合条件。\nSELECT * FROM score WHERE c_no = '3-105' AND degree > ALL(\n    SELECT degree FROM score WHERE c_no = '3-245'\n);\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 101 : 3-105:     90\n- 102 : 3-105:     91\n- 103 : 3-105:     92\n- 104 : 3-105:     89\n- 105 : 3-105:     88\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"复制表的数据作为条件查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制表的数据作为条件查询"}},[s._v("#")]),s._v(" 复制表的数据作为条件查询")]),s._v(" "),n("p",[n("strong",[s._v("查询某课程成绩比该课程平均成绩低的 "),n("code",[s._v("score")]),s._v(" 表。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 查询平均分\nSELECT c_no, AVG(degree) FROM score GROUP BY c_no;\n+-------+-------------+\n- c_no : AVG(degree)\n+-------+-------------+\n- 3-105:     87.6667\n- 3-245:     76.3333\n- 6-166:     81.6667\n+-------+-------------+\n\n-- 查询 score 表\nSELECT degree FROM score;\n+--------+\n- degree\n+--------+\n-     90\n-     91\n-     92\n-     86\n-     85\n-     89\n-     88\n-     75\n-     79\n-     76\n-     68\n-     81\n+--------+\n\n-- 将表 b 作用于表 a 中查询数据\n-- score a (b): 将表声明为 a (b),\n-- 如此就能用 a.c_no = b.c_no 作为条件执行查询了。\nSELECT * FROM score a WHERE degree < (\n    (SELECT AVG(degree) FROM score b WHERE a.c_no = b.c_no)\n);\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 105 : 3-245:     75\n- 105 : 6-166:     79\n- 109 : 3-105:     76\n- 109 : 3-245:     68\n- 109 : 6-166:     81\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("h3",{attrs:{id:"子查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询"}},[s._v("#")]),s._v(" 子查询")]),s._v(" "),n("p",[n("strong",[s._v("查询所有任课 ( 在 "),n("code",[s._v("course")]),s._v(" 表里有课程 ) 教师的 "),n("code",[s._v("name")]),s._v(" 和 "),n("code",[s._v("department")])]),s._v(" 。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT name, department FROM teacher WHERE no IN (SELECT t_no FROM course);\n+--------+-----------------+\n- name  : department\n+--------+-----------------+\n- 李诚  : 计算机系\n- 王萍  : 计算机系\n- 刘冰  : 电子工程系\n- 张旭  : 电子工程系\n+--------+-----------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"条件加组筛选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#条件加组筛选"}},[s._v("#")]),s._v(" 条件加组筛选")]),s._v(" "),n("p",[n("strong",[s._v("查询 "),n("code",[s._v("student")]),s._v(" 表中至少有 2 名男生的 "),n("code",[s._v("class")]),s._v(" 。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 查看学生表信息\nSELECT * FROM student;\n+-----+-----------+-----+------------+-------+\n- no : name     : sex: birthday  : class\n+-----+-----------+-----+------------+-------+\n- 101: 曾华     : 男 : 1977-09-01: 95033\n- 102: 匡明     : 男 : 1975-10-02: 95031\n- 103: 王丽     : 女 : 1976-01-23: 95033\n- 104: 李军     : 男 : 1976-02-20: 95033\n- 105: 王芳     : 女 : 1975-02-10: 95031\n- 106: 陆军     : 男 : 1974-06-03: 95031\n- 107: 王尼玛   : 男 : 1976-02-20: 95033\n- 108: 张全蛋   : 男 : 1975-02-10: 95031\n- 109: 赵铁柱   : 男 : 1974-06-03: 95031\n- 110: 张飞     : 男 : 1974-06-03: 95038\n+-----+-----------+-----+------------+-------+\n\n-- 只查询性别为男, 然后按 class 分组, 并限制 class 行大于 1。\nSELECT class FROM student WHERE sex = '男' GROUP BY class HAVING COUNT(*) > 1;\n+-------+\n- class\n+-------+\n- 95033\n- 95031\n+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h3",{attrs:{id:"not-like-模糊查询取反"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#not-like-模糊查询取反"}},[s._v("#")]),s._v(" NOT LIKE 模糊查询取反")]),s._v(" "),n("p",[n("strong",[s._v("查询 "),n("code",[s._v("student")]),s._v(' 表中不姓 "王" 的同学记录。')])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- NOT: 取反\n-- LIKE: 模糊查询\n\nmysql> SELECT * FROM student WHERE name NOT LIKE '王%';\n+-----+-----------+-----+------------+-------+\n- no : name     : sex: birthday  : class\n+-----+-----------+-----+------------+-------+\n- 101: 曾华     : 男 : 1977-09-01: 95033\n- 102: 匡明     : 男 : 1975-10-02: 95031\n- 104: 李军     : 男 : 1976-02-20: 95033\n- 106: 陆军     : 男 : 1974-06-03: 95031\n- 108: 张全蛋   : 男 : 1975-02-10: 95031\n- 109: 赵铁柱   : 男 : 1974-06-03: 95031\n- 110: 张飞     : 男 : 1974-06-03: 95038\n+-----+-----------+-----+------------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"year-与-now-函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#year-与-now-函数"}},[s._v("#")]),s._v(" YEAR 与 NOW 函数")]),s._v(" "),n("p",[n("strong",[s._v("查询 "),n("code",[s._v("student")]),s._v(" 表中每个学生的姓名和年龄。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 使用函数 YEAR(NOW()) 计算出当前年份, 减去出生年份后得出年龄。\nSELECT name, YEAR(NOW()) - YEAR(birthday) as age FROM student;\n+-----------+------+\n- name     : age\n+-----------+------+\n- 曾华     :   42\n- 匡明     :   44\n- 王丽     :   43\n- 李军     :   43\n- 王芳     :   44\n- 陆军     :   45\n- 王尼玛   :   43\n- 张全蛋   :   44\n- 赵铁柱   :   45\n- 张飞     :   45\n+-----------+------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h3",{attrs:{id:"max-与-min-函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#max-与-min-函数"}},[s._v("#")]),s._v(" MAX 与 MIN 函数")]),s._v(" "),n("p",[n("strong",[s._v("查询 "),n("code",[s._v("student")]),s._v(" 表中最大和最小的 "),n("code",[s._v("birthday")]),s._v(" 值。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT MAX(birthday), MIN(birthday) FROM student;\n+---------------+---------------+\n- MAX(birthday): MIN(birthday)\n+---------------+---------------+\n- 1977-09-01   : 1974-06-03\n+---------------+---------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"多段排序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多段排序"}},[s._v("#")]),s._v(" 多段排序")]),s._v(" "),n("p",[n("strong",[s._v("以 "),n("code",[s._v("class")]),s._v(" 和 "),n("code",[s._v("birthday")]),s._v(" 从大到小的顺序查询 "),n("code",[s._v("student")]),s._v(" 表。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM student ORDER BY class DESC, birthday;\n+-----+-----------+-----+------------+-------+\n- no : name     : sex: birthday  : class\n+-----+-----------+-----+------------+-------+\n- 110: 张飞     : 男 : 1974-06-03: 95038\n- 103: 王丽     : 女 : 1976-01-23: 95033\n- 104: 李军     : 男 : 1976-02-20: 95033\n- 107: 王尼玛   : 男 : 1976-02-20: 95033\n- 101: 曾华     : 男 : 1977-09-01: 95033\n- 106: 陆军     : 男 : 1974-06-03: 95031\n- 109: 赵铁柱   : 男 : 1974-06-03: 95031\n- 105: 王芳     : 女 : 1975-02-10: 95031\n- 108: 张全蛋   : 男 : 1975-02-10: 95031\n- 102: 匡明     : 男 : 1975-10-02: 95031\n+-----+-----------+-----+------------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"子查询-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询-4"}},[s._v("#")]),s._v(" 子查询")]),s._v(" "),n("p",[n("strong",[s._v('查询 "男" 教师及其所上的课程。')])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM course WHERE t_no in (SELECT no FROM teacher WHERE sex = '男');\n+-------+--------------+------+\n- no   : name        : t_no\n+-------+--------------+------+\n- 3-245: 操作系统    : 804\n- 6-166: 数字电路    : 856\n+-------+--------------+------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"max-函数与子查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#max-函数与子查询"}},[s._v("#")]),s._v(" MAX 函数与子查询")]),s._v(" "),n("p",[n("strong",[s._v("查询最高分同学的 "),n("code",[s._v("score")]),s._v(" 表。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 找出最高成绩(该查询只能有一个结果)\nSELECT MAX(degree) FROM score;\n\n-- 根据上面的条件筛选出所有最高成绩表,\n-- 该查询可能有多个结果, 假设 degree 值多次符合条件。\nSELECT * FROM score WHERE degree = (SELECT MAX(degree) FROM score);\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 103 : 3-105:     92\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"子查询-6"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询-6"}},[s._v("#")]),s._v(" 子查询 - 6")]),s._v(" "),n("p",[n("strong",[s._v('查询和 "李军" 同性别的所有同学 '),n("code",[s._v("name")]),s._v(" 。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 首先将李军的性别作为条件取出来\nSELECT sex FROM student WHERE name = '李军';\n+-----+\n- sex\n+-----+\n- 男\n+-----+\n\n-- 根据性别查询 name 和 sex\nSELECT name, sex FROM student WHERE sex = (\n    SELECT sex FROM student WHERE name = '李军'\n);\n+-----------+-----+\n- name     : sex\n+-----------+-----+\n- 曾华     : 男\n- 匡明     : 男\n- 李军     : 男\n- 陆军     : 男\n- 王尼玛   : 男\n- 张全蛋   : 男\n- 赵铁柱   : 男\n- 张飞     : 男\n+-----------+-----+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h3",{attrs:{id:"子查询-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询-5"}},[s._v("#")]),s._v(" 子查询")]),s._v(" "),n("p",[n("strong",[s._v('查询和 "李军" 同性别且同班的同学 '),n("code",[s._v("name")]),s._v(" 。")])]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT name, sex, class FROM student WHERE sex = (\n    SELECT sex FROM student WHERE name = '李军'\n) AND class = (\n    SELECT class FROM student WHERE name = '李军'\n);\n+-----------+-----+-------+\n- name     : sex: class\n+-----------+-----+-------+\n- 曾华     : 男 : 95033\n- 李军     : 男 : 95033\n- 王尼玛   : 男 : 95033\n+-----------+-----+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"子查询-7"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子查询-7"}},[s._v("#")]),s._v(" 子查询")]),s._v(" "),n("p",[n("strong",[s._v('查询所有选修 "计算机导论" 课程的 "男" 同学成绩表。')])]),s._v(" "),n("p",[s._v('需要的 "计算机导论" 和性别为 "男" 的编号可以在 '),n("code",[s._v("course")]),s._v(" 和 "),n("code",[s._v("student")]),s._v(" 表中找到。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM score WHERE c_no = (\n    SELECT no FROM course WHERE name = '计算机导论'\n) AND s_no IN (\n    SELECT no FROM student WHERE sex = '男'\n);\n+------+-------+--------+\n- s_no: c_no : degree\n+------+-------+--------+\n- 101 : 3-105:     90\n- 102 : 3-105:     91\n- 104 : 3-105:     89\n- 109 : 3-105:     76\n+------+-------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"按等级查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#按等级查询"}},[s._v("#")]),s._v(" 按等级查询")]),s._v(" "),n("p",[s._v("建立一个 "),n("code",[s._v("grade")]),s._v(" 表代表学生的成绩等级, 并插入数据:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE TABLE grade (\n    low INT(3),\n    upp INT(3),\n    grade char(1)\n);\n\nINSERT INTO grade VALUES (90, 100, 'A');\nINSERT INTO grade VALUES (80, 89, 'B');\nINSERT INTO grade VALUES (70, 79, 'C');\nINSERT INTO grade VALUES (60, 69, 'D');\nINSERT INTO grade VALUES (0, 59, 'E');\n\nSELECT * FROM grade;\n+------+------+-------+\n- low : upp : grade\n+------+------+-------+\n-   90:  100: A\n-   80:   89: B\n-   70:   79: C\n-   60:   69: D\n-    0:   59: E\n+------+------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[n("strong",[s._v("查询所有学生的 "),n("code",[s._v("s_no")]),s._v(" 、"),n("code",[s._v("c_no")]),s._v(" 和 "),n("code",[s._v("grade")]),s._v(" 列。")])]),s._v(" "),n("p",[s._v("思路是, 使用区间 ( "),n("code",[s._v("BETWEEN")]),s._v(" ) 查询, 判断学生的成绩 ( "),n("code",[s._v("degree")]),s._v(" ) 在 "),n("code",[s._v("grade")]),s._v(" 表的 "),n("code",[s._v("low")]),s._v(" 和 "),n("code",[s._v("upp")]),s._v(" 之间。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT s_no, c_no, grade FROM score, grade\nWHERE degree BETWEEN low AND upp;\n+------+-------+-------+\n- s_no: c_no : grade\n+------+-------+-------+\n- 101 : 3-105: A\n- 102 : 3-105: A\n- 103 : 3-105: A\n- 103 : 3-245: B\n- 103 : 6-166: B\n- 104 : 3-105: B\n- 105 : 3-105: B\n- 105 : 3-245: C\n- 105 : 6-166: C\n- 109 : 3-105: C\n- 109 : 3-245: D\n- 109 : 6-166: B\n+------+-------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"连接查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#连接查询"}},[s._v("#")]),s._v(" 连接查询")]),s._v(" "),n("p",[s._v("准备用于测试连接查询的数据:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE DATABASE testJoin;\n\nCREATE TABLE person (\n    id INT,\n    name VARCHAR(20),\n    cardId INT\n);\n\nCREATE TABLE card (\n    id INT,\n    name VARCHAR(20)\n);\n\nINSERT INTO card VALUES (1, '饭卡'), (2, '建行卡'), (3, '农行卡'), (4, '工商卡'), (5, '邮政卡');\nSELECT * FROM card;\n+------+-----------+\n- id  : name\n+------+-----------+\n-    1: 饭卡\n-    2: 建行卡\n-    3: 农行卡\n-    4: 工商卡\n-    5: 邮政卡\n+------+-----------+\n\nINSERT INTO person VALUES (1, '张三', 1), (2, '李四', 3), (3, '王五', 6);\nSELECT * FROM person;\n+------+--------+--------+\n- id  : name  : cardId\n+------+--------+--------+\n-    1: 张三  :      1\n-    2: 李四  :      3\n-    3: 王五  :      6\n+------+--------+--------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("p",[s._v("分析两张表发现, "),n("code",[s._v("person")]),s._v(" 表并没有为 "),n("code",[s._v("cardId")]),s._v(" 字段设置一个在 "),n("code",[s._v("card")]),s._v(" 表中对应的 "),n("code",[s._v("id")]),s._v(" 外键。如果设置了的话, "),n("code",[s._v("person")]),s._v(" 中 "),n("code",[s._v("cardId")]),s._v(" 字段值为 "),n("code",[s._v("6")]),s._v(" 的行就插不进去, 因为该 "),n("code",[s._v("cardId")]),s._v(" 值在 "),n("code",[s._v("card")]),s._v(" 表中并没有。")]),s._v(" "),n("h4",{attrs:{id:"内连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内连接"}},[s._v("#")]),s._v(" 内连接")]),s._v(" "),n("p",[s._v("要查询这两张表中有关系的数据, 可以使用 "),n("code",[s._v("INNER JOIN")]),s._v(" ( 内连接 ) 将它们连接在一起。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- INNER JOIN: 表示为内连接, 将两张表拼接在一起。\n-- on: 表示要执行某个条件。\nSELECT * FROM person INNER JOIN card on person.cardId = card.id;\n+------+--------+--------+------+-----------+\n- id  : name  : cardId: id  : name\n+------+--------+--------+------+-----------+\n-    1: 张三  :      1:    1: 饭卡\n-    2: 李四  :      3:    3: 农行卡\n+------+--------+--------+------+-----------+\n\n-- 将 INNER 关键字省略掉, 结果也是一样的。\n-- SELECT * FROM person JOIN card on person.cardId = card.id;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("blockquote",[n("p",[s._v("注意: "),n("code",[s._v("card")]),s._v(" 的整张表被连接到了右边。")])]),s._v(" "),n("h4",{attrs:{id:"左外连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#左外连接"}},[s._v("#")]),s._v(" 左外连接")]),s._v(" "),n("p",[s._v("完整显示左边的表 ( "),n("code",[s._v("person")]),s._v(" ) , 右边的表如果符合条件就显示, 不符合则补 "),n("code",[s._v("NULL")]),s._v(" 。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- LEFT JOIN 也叫做 LEFT OUTER JOIN, 用这两种方式的查询结果是一样的。\n\nSELECT * FROM person LEFT JOIN card on person.cardId = card.id;\n+------+--------+--------+------+-----------+\n- id  : name  : cardId: id  : name\n+------+--------+--------+------+-----------+\n-    1: 张三  :      1:    1: 饭卡\n-    2: 李四  :      3:    3: 农行卡\n-    3: 王五  :      6: NULL: NULL\n+------+--------+--------+------+-----------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h4",{attrs:{id:"右外链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#右外链接"}},[s._v("#")]),s._v(" 右外链接")]),s._v(" "),n("p",[s._v("完整显示右边的表 ( "),n("code",[s._v("card")]),s._v(" ) , 左边的表如果符合条件就显示, 不符合则补 "),n("code",[s._v("NULL")]),s._v(" 。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SELECT * FROM person RIGHT JOIN card on person.cardId = card.id;\n+------+--------+--------+------+-----------+\n- id  : name  : cardId: id  : name\n+------+--------+--------+------+-----------+\n-    1: 张三  :      1:    1: 饭卡\n-    2: 李四  :      3:    3: 农行卡\n- NULL: NULL  :   NULL:    2: 建行卡\n- NULL: NULL  :   NULL:    4: 工商卡\n- NULL: NULL  :   NULL:    5: 邮政卡\n+------+--------+--------+------+-----------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h4",{attrs:{id:"全外链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全外链接"}},[s._v("#")]),s._v(" 全外链接")]),s._v(" "),n("p",[s._v("完整显示两张表的全部数据。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- MySQL 不支持这种语法的全外连接\n-- SELECT * FROM person FULL JOIN card on person.cardId = card.id;\n-- 出现错误:\n-- ERROR 1054 (42S22): Unknown column 'person.cardId' in 'on clause'\n\n-- MySQL全连接语法, 使用 UNION 将两张表合并在一起。\nSELECT * FROM person LEFT JOIN card on person.cardId = card.id\nUNION\nSELECT * FROM person RIGHT JOIN card on person.cardId = card.id;\n+------+--------+--------+------+-----------+\n- id  : name  : cardId: id  : name\n+------+--------+--------+------+-----------+\n-    1: 张三  :      1:    1: 饭卡\n-    2: 李四  :      3:    3: 农行卡\n-    3: 王五  :      6: NULL: NULL\n- NULL: NULL  :   NULL:    2: 建行卡\n- NULL: NULL  :   NULL:    4: 工商卡\n- NULL: NULL  :   NULL:    5: 邮政卡\n+------+--------+--------+------+-----------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h2",{attrs:{id:"事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[s._v("#")]),s._v(" 事务")]),s._v(" "),n("p",[s._v("在 MySQL 中, 事务其实是一个最小的不可分割的工作单元。事务能够"),n("strong",[s._v("保证一个业务的完整性")]),s._v("。")]),s._v(" "),n("p",[s._v("比如我们的银行转账:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- a -> -100\nUPDATE user set money = money - 100 WHERE name = 'a';\n\n-- b -> +100\nUPDATE user set money = money + 100 WHERE name = 'b';\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("在实际项目中, 假设只有一条 SQL 语句执行成功, 而另外一条执行失败了, 就会出现数据前后不一致。")]),s._v(" "),n("p",[s._v("因此, 在执行多条有关联 SQL 语句时, "),n("strong",[s._v("事务")]),s._v("可能会要求这些 SQL 语句要么同时执行成功, 要么就都执行失败。")]),s._v(" "),n("h3",{attrs:{id:"如何控制事务-commit-rollback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何控制事务-commit-rollback"}},[s._v("#")]),s._v(" 如何控制事务 - COMMIT / ROLLBACK")]),s._v(" "),n("p",[s._v("在 MySQL 中, 事务的"),n("strong",[s._v("自动提交")]),s._v("状态默认是开启的。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 查询事务的自动提交状态\nSELECT @@AUTOCOMMIT;\n+--------------+\n- @@AUTOCOMMIT\n+--------------+\n-            1\n+--------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("自动提交的作用")]),s._v(": 当我们执行一条 SQL 语句的时候, 其产生的效果就会立即体现出来, 且不能"),n("strong",[s._v("回滚")]),s._v("。")]),s._v(" "),n("p",[s._v("什么是回滚？举个例子:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE DATABASE bank;\n\nUSE bank;\n\nCREATE TABLE user (\n    id INT PRIMARY KEY,\n    name VARCHAR(20),\n    money INT\n);\n\nINSERT INTO user VALUES (1, 'a', 1000);\n\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :  1000\n+----+------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("可以看到, 在执行插入语句后数据立刻生效, 原因是 MySQL 中的事务自动将它"),n("strong",[s._v("提交")]),s._v("到了数据库中。那么所谓"),n("strong",[s._v("回滚")]),s._v("的意思就是, 撤销执行过的所有 SQL 语句, 使其回滚到"),n("strong",[s._v("最后一次提交")]),s._v("数据时的状态。")]),s._v(" "),n("p",[s._v("在 MySQL 中使用 "),n("code",[s._v("ROLLBACK")]),s._v(" 执行回滚:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 回滚到最后一次提交\nROLLBACK;\n\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :  1000\n+----+------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("由于所有执行过的 SQL 语句都已经被提交过了, 所以数据并没有发生回滚。那如何让数据可以发生回滚？")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 关闭自动提交\nSET AUTOCOMMIT = 0;\n\n-- 查询自动提交状态\nSELECT @@AUTOCOMMIT;\n+--------------+\n- @@AUTOCOMMIT\n+--------------+\n-            0\n+--------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("将自动提交关闭后, 测试数据回滚:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("INSERT INTO user VALUES (2, 'b', 1000);\n\n-- 关闭 AUTOCOMMIT 后, 数据的变化是在一张虚拟的临时数据表中展示,\n-- 发生变化的数据并没有真正插入到数据表中。\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :  1000\n-  2: b   :  1000\n+----+------+-------+\n\n-- 数据表中的真实数据其实还是:\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :  1000\n+----+------+-------+\n\n-- 由于数据还没有真正提交, 可以使用回滚\nROLLBACK;\n\n-- 再次查询\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :  1000\n+----+------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("那如何将虚拟的数据真正提交到数据库中？使用 "),n("code",[s._v("COMMIT")]),s._v(" :")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("INSERT INTO user VALUES (2, 'b', 1000);\n-- 手动提交数据(持久性),\n-- 将数据真正提交到数据库中, 执行后不能再回滚提交过的数据。\nCOMMIT;\n\n-- 提交后测试回滚\nROLLBACK;\n\n-- 再次查询(回滚无效了)\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :  1000\n-  2: b   :  1000\n+----+------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[n("strong",[s._v("总结")])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("自动提交")]),s._v(" "),n("ul",[n("li",[s._v("查看自动提交状态: "),n("code",[s._v("SELECT @@AUTOCOMMIT")]),s._v(" ；")]),s._v(" "),n("li",[s._v("设置自动提交状态: "),n("code",[s._v("SET AUTOCOMMIT = 0")]),s._v(" 。")])])]),s._v(" "),n("li",[n("p",[s._v("手动提交\n"),n("code",[s._v("@@AUTOCOMMIT = 0")]),s._v(" 时, 使用 "),n("code",[s._v("COMMIT")]),s._v(" 命令提交事务。")])]),s._v(" "),n("li",[n("p",[s._v("事务回滚\n"),n("code",[s._v("@@AUTOCOMMIT = 0")]),s._v(" 时, 使用 "),n("code",[s._v("ROLLBACK")]),s._v(" 命令回滚事务。")])])]),s._v(" "),n("p",[n("strong",[s._v("事务的实际应用")]),s._v(", 让我们再回到银行转账项目:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 转账\nUPDATE user set money = money - 100 WHERE name = 'a';\n\n-- 到账\nUPDATE user set money = money + 100 WHERE name = 'b';\n\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :   900\n-  2: b   :  1100\n+----+------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("这时假设在转账时发生了意外, 就可以使用 "),n("code",[s._v("ROLLBACK")]),s._v(" 回滚到最后一次提交的状态:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 假设转账发生了意外, 需要回滚。\nROLLBACK;\n\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :  1000\n-  2: b   :  1000\n+----+------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("这时我们又回到了发生意外之前的状态, 也就是说, 事务给我们提供了一个可以反悔的机会。假设数据没有发生意外, 这时可以手动将数据真正提交到数据表中: "),n("code",[s._v("COMMIT")]),s._v(" 。")]),s._v(" "),n("h3",{attrs:{id:"手动开启事务-begin-start-transaction"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#手动开启事务-begin-start-transaction"}},[s._v("#")]),s._v(" 手动开启事务 - BEGIN / START TRANSACTION")]),s._v(" "),n("p",[s._v("事务的默认提交被开启 ( "),n("code",[s._v("@@AUTOCOMMIT = 1")]),s._v(" ) 后, 此时就不能使用事务回滚了。但是我们还可以手动开启一个事务处理事件, 使其可以发生回滚:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 使用 BEGIN 或者 START TRANSACTION 手动开启一个事务\n-- START TRANSACTION;\nBEGIN;\nUPDATE user set money = money - 100 WHERE name = 'a';\nUPDATE user set money = money + 100 WHERE name = 'b';\n\n-- 由于手动开启的事务没有开启自动提交,\n-- 此时发生变化的数据仍然是被保存在一张临时表中。\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :   900\n-  2: b   :  1100\n+----+------+-------+\n\n-- 测试回滚\nROLLBACK;\n\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :  1000\n-  2: b   :  1000\n+----+------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("p",[s._v("仍然使用 "),n("code",[s._v("COMMIT")]),s._v(" 提交数据, 提交后无法再发生本次事务的回滚。")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("BEGIN;\nUPDATE user set money = money - 100 WHERE name = 'a';\nUPDATE user set money = money + 100 WHERE name = 'b';\n\nSELECT * FROM user;\n+----+------+-------+\n- id: name: money\n+----+------+-------+\n-  1: a   :   900\n-  2: b   :  1100\n+----+------+-------+\n\n-- 提交数据\nCOMMIT;\n\n-- 测试回滚(无效, 因为表的数据已经被提交)\nROLLBACK;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"事务的-acid-特征与使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事务的-acid-特征与使用"}},[s._v("#")]),s._v(" 事务的 ACID 特征与使用")]),s._v(" "),n("p",[n("strong",[s._v("事务的四大特征")])]),s._v(" "),n("ul",[n("li",[s._v("A(Atomicity) 原子性: 事务是最小的单位, 不可以再分割")]),s._v(" "),n("li",[s._v("C(Consistency) 一致性: 要求同一事务中的 SQL 语句, 必须保证同时成功或者失败")]),s._v(" "),n("li",[s._v("I(Isolation) 隔离性: 事务 1 和 事务 2 之间是具有隔离性的")]),s._v(" "),n("li",[s._v("D(Durability) 持久性: 事务一旦结束 ( "),n("code",[s._v("COMMIT")]),s._v(" ) , 就不可以再返回了 ( "),n("code",[s._v("ROLLBACK")]),s._v(" )")])]),s._v(" "),n("h4",{attrs:{id:"事务的隔离性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事务的隔离性"}},[s._v("#")]),s._v(" 事务的隔离性")]),s._v(" "),n("p",[n("strong",[s._v("事务的隔离性可分为四种 ( 性能从低到高 )")]),s._v(" :")]),s._v(" "),n("ol",[n("li",[n("p",[n("strong",[s._v("READ UNCOMMITTED ( 读取未提交 )")])]),s._v(" "),n("p",[s._v("如果有多个事务, 那么任意事务都可以看见其他事务的"),n("strong",[s._v("未提交数据")]),s._v("。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("READ COMMITTED ( 读取已提交 )")])]),s._v(" "),n("p",[s._v("只能读取到其他事务"),n("strong",[s._v("已经提交的数据")]),s._v("。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("REPEATABLE READ ( 可被重复读 )")])]),s._v(" "),n("p",[s._v("如果有多个连接都开启了事务, 那么事务之间不能共享数据记录, 否则只能共享已提交的记录。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("SERIALIZABLE ( 串行化 )")])]),s._v(" "),n("p",[s._v("所有的事务都会按照"),n("strong",[s._v("固定顺序执行")]),s._v(", 执行完一个事务后再继续执行下一个事务的"),n("strong",[s._v("写入操作")]),s._v("。")])])]),s._v(" "),n("p",[s._v("查看当前数据库的默认隔离级别:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- MySQL 8.x, GLOBAL 表示系统级别, 不加表示会话级别。\nSELECT @@GLOBAL.TRANSACTION_ISOLATION;\nSELECT @@TRANSACTION_ISOLATION;\n+--------------------------------+\n- @@GLOBAL.TRANSACTION_ISOLATION\n+--------------------------------+\n- REPEATABLE-READ               : -- MySQL的默认隔离级别, 可以重复读。\n+--------------------------------+\n\n-- MySQL 5.x\nSELECT @@GLOBAL.TX_ISOLATION;\nSELECT @@TX_ISOLATION;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("修改隔离级别:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 设置系统隔离级别, LEVEL 后面表示要设置的隔离级别 (READ UNCOMMITTED)。\nSET GLOBAL TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\n\n-- 查询系统隔离级别, 发现已经被修改。\nSELECT @@GLOBAL.TRANSACTION_ISOLATION;\n+--------------------------------+\n- @@GLOBAL.TRANSACTION_ISOLATION\n+--------------------------------+\n- READ-UNCOMMITTED\n+--------------------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h4",{attrs:{id:"脏读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#脏读"}},[s._v("#")]),s._v(" 脏读")]),s._v(" "),n("p",[s._v("测试 "),n("strong",[s._v("READ UNCOMMITTED ( 读取未提交 )")]),s._v(" 的隔离性:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("INSERT INTO user VALUES (3, '小明', 1000);\nINSERT INTO user VALUES (4, '淘宝店', 1000);\n\nSELECT * FROM user;\n+----+-----------+-------+\n- id: name     : money\n+----+-----------+-------+\n-  1: a        :   900\n-  2: b        :  1100\n-  3: 小明     :  1000\n-  4: 淘宝店   :  1000\n+----+-----------+-------+\n\n-- 开启一个事务操作数据\n-- 假设小明在淘宝店买了一双800块钱的鞋子:\nSTART TRANSACTION;\nUPDATE user SET money = money - 800 WHERE name = '小明';\nUPDATE user SET money = money + 800 WHERE name = '淘宝店';\n\n-- 然后淘宝店在另一方查询结果, 发现钱已到账。\nSELECT * FROM user;\n+----+-----------+-------+\n- id: name     : money\n+----+-----------+-------+\n-  1: a        :   900\n-  2: b        :  1100\n-  3: 小明     :   200\n-  4: 淘宝店   :  1800\n+----+-----------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("由于小明的转账是在新开启的事务上进行操作的, 而该操作的结果是可以被其他事务(另一方的淘宝店)看见的, 因此淘宝店的查询结果是正确的, 淘宝店确认到账。但就在这时, 如果小明在它所处的事务上又执行了 "),n("code",[s._v("ROLLBACK")]),s._v(" 命令, 会发生什么？")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 小明所处的事务\nROLLBACK;\n\n-- 此时无论对方是谁, 如果再去查询结果就会发现:\nSELECT * FROM user;\n+----+-----------+-------+\n- id: name     : money\n+----+-----------+-------+\n-  1: a        :   900\n-  2: b        :  1100\n-  3: 小明     :  1000\n-  4: 淘宝店   :  1000\n+----+-----------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("这就是所谓的"),n("strong",[s._v("脏读")]),s._v(", 一个事务读取到另外一个事务还未提交的数据。这在实际开发中是不允许出现的。")]),s._v(" "),n("h4",{attrs:{id:"读取已提交"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#读取已提交"}},[s._v("#")]),s._v(" 读取已提交")]),s._v(" "),n("p",[s._v("把隔离级别设置为 "),n("strong",[s._v("READ COMMITTED")]),s._v(" :")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED;\nSELECT @@GLOBAL.TRANSACTION_ISOLATION;\n+--------------------------------+\n- @@GLOBAL.TRANSACTION_ISOLATION\n+--------------------------------+\n- READ-COMMITTED\n+--------------------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("这样, 再有新的事务连接进来时, 它们就只能查询到已经提交过的事务数据了。但是对于当前事务来说, 它们看到的还是未提交的数据, 例如:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 正在操作数据事务(当前事务)\nSTART TRANSACTION;\nUPDATE user SET money = money - 800 WHERE name = '小明';\nUPDATE user SET money = money + 800 WHERE name = '淘宝店';\n\n-- 虽然隔离级别被设置为了 READ COMMITTED, 但在当前事务中,\n-- 它看到的仍然是数据表中临时改变数据, 而不是真正提交过的数据。\nSELECT * FROM user;\n+----+-----------+-------+\n- id: name     : money\n+----+-----------+-------+\n-  1: a        :   900\n-  2: b        :  1100\n-  3: 小明     :   200\n-  4: 淘宝店   :  1800\n+----+-----------+-------+\n\n\n-- 假设此时在远程开启了一个新事务, 连接到数据库。\n$ mysql -u root -p12345612\n\n-- 此时远程连接查询到的数据只能是已经提交过的\nSELECT * FROM user;\n+----+-----------+-------+\n- id: name     : money\n+----+-----------+-------+\n-  1: a        :   900\n-  2: b        :  1100\n-  3: 小明     :  1000\n-  4: 淘宝店   :  1000\n+----+-----------+-------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("p",[s._v("但是这样还有问题, 那就是假设一个事务在操作数据时, 其他事务干扰了这个事务的数据。例如:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 小张在查询数据的时候发现:\nSELECT * FROM user;\n+----+-----------+-------+\n- id: name     : money\n+----+-----------+-------+\n-  1: a        :   900\n-  2: b        :  1100\n-  3: 小明     :   200\n-  4: 淘宝店   :  1800\n+----+-----------+-------+\n\n-- 在小张求表的 money 平均值之前, 小王做了一个操作:\nSTART TRANSACTION;\nINSERT INTO user VALUES (5, 'c', 100);\nCOMMIT;\n\n-- 此时表的真实数据是:\nSELECT * FROM user;\n+----+-----------+-------+\n- id: name     : money\n+----+-----------+-------+\n-  1: a        :   900\n-  2: b        :  1100\n-  3: 小明     :  1000\n-  4: 淘宝店   :  1000\n-  5: c        :   100\n+----+-----------+-------+\n\n-- 这时小张再求平均值的时候, 就会出现计算不相符合的情况:\nSELECT AVG(money) FROM user;\n+------------+\n- AVG(money)\n+------------+\n-  820.0000\n+------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("p",[s._v("虽然 "),n("strong",[s._v("READ COMMITTED")]),s._v(" 让我们只能读取到其他事务已经提交的数据, 但还是会出现问题, 就是"),n("strong",[s._v("在读取同一个表的数据时, 可能会发生前后不一致的情况。"),n("strong",[s._v("这被称为")]),s._v("不可重复读现象 ( READ COMMITTED )")]),s._v(" 。")]),s._v(" "),n("h4",{attrs:{id:"幻读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#幻读"}},[s._v("#")]),s._v(" 幻读")]),s._v(" "),n("p",[s._v("将隔离级别设置为 "),n("strong",[s._v("REPEATABLE READ ( 可被重复读取 )")]),s._v(" :")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ;\nSELECT @@GLOBAL.TRANSACTION_ISOLATION;\n+--------------------------------+\n- @@GLOBAL.TRANSACTION_ISOLATION\n+--------------------------------+\n- REPEATABLE-READ\n+--------------------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("测试 "),n("strong",[s._v("REPEATABLE READ")]),s._v(" , 假设在两个不同的连接上分别执行 "),n("code",[s._v("START TRANSACTION")]),s._v(" :")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 小张 - 成都")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRANSACTION")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 小王 - 北京")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRANSACTION")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 小张 - 成都")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMIT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("当前事务开启后, 没提交之前, 查询不到, 提交后可以被查询到。但是, 在提交之前其他事务被开启了, 那么在这条事务线上, 就不会查询到当前有操作事务的连接。相当于开辟出一条单独的线程。")]),s._v(" "),n("p",[s._v("无论小张是否执行过 "),n("code",[s._v("COMMIT")]),s._v(" , 在小王这边, 都不会查询到小张的事务记录, 而是只会查询到自己所处事务的记录:")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+-----------+-------+")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" id: name     : money\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+-----------+-------+")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": a        :   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": b        :  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": 小明     :  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(": 淘宝店   :  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(": c        :   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+-----------+-------+")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("这是"),n("strong",[s._v("因为小王在此之前开启了一个新的事务 ( "),n("code",[s._v("START TRANSACTION")]),s._v(" )")]),s._v(", 那么"),n("strong",[s._v("在他的这条新事务的线上, 跟其他事务是没有联系的")]),s._v(", 也就是说, 此时如果其他事务正在操作数据, 它是不知道的。")]),s._v(" "),n("p",[s._v("然而事实是, 在真实的数据表中, 小张已经插入了一条数据。但是小王此时并不知道, 也插入了同一条数据, 会发生什么呢？")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ERROR 1062 (23000): Duplicate entry '6' for key 'PRIMARY'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("报错了, 操作被告知已存在主键为 "),n("code",[s._v("6")]),s._v(" 的字段。这种现象也被称为"),n("strong",[s._v("幻读, 一个事务提交的数据, 不能被其他事务读取到")]),s._v("。")]),s._v(" "),n("h4",{attrs:{id:"串行化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#串行化"}},[s._v("#")]),s._v(" 串行化")]),s._v(" "),n("p",[s._v("顾名思义, 就是所有事务的"),n("strong",[s._v("写入操作")]),s._v("全都是串行化的。什么意思？把隔离级别修改成 "),n("strong",[s._v("SERIALIZABLE")]),s._v(" :")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SET GLOBAL TRANSACTION ISOLATION LEVEL SERIALIZABLE;\nSELECT @@GLOBAL.TRANSACTION_ISOLATION;\n+--------------------------------+\n- @@GLOBAL.TRANSACTION_ISOLATION\n+--------------------------------+\n- SERIALIZABLE\n+--------------------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("还是拿小张和小王来举例:")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-- 小张 - 成都\nSTART TRANSACTION;\n\n-- 小王 - 北京\nSTART TRANSACTION;\n\n-- 开启事务之前先查询表, 准备操作数据。\nSELECT * FROM user;\n+----+-----------+-------+\n- id: name     : money\n+----+-----------+-------+\n-  1: a        :   900\n-  2: b        :  1100\n-  3: 小明     :  1000\n-  4: 淘宝店   :  1000\n-  5: c        :   100\n-  6: d        :  1000\n+----+-----------+-------+\n\n-- 发现没有 7 号王小花, 于是插入一条数据:\nINSERT INTO user VALUES (7, '王小花', 1000);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("此时会发生什么呢？由于现在的隔离级别是 "),n("strong",[s._v("SERIALIZABLE ( 串行化 )")]),s._v(" , 串行化的意思就是: 假设把所有的事务都放在一个串行的队列中, 那么所有的事务都会按照"),n("strong",[s._v("固定顺序执行")]),s._v(", 执行完一个事务后再继续执行下一个事务的"),n("strong",[s._v("写入操作")]),s._v(" ( "),n("strong",[s._v("这意味着队列中同时只能执行一个事务的写入操作")]),s._v(" ) 。")]),s._v(" "),n("p",[s._v("根据这个解释, 小王在插入数据时, 会出现等待状态, 直到小张执行 "),n("code",[s._v("COMMIT")]),s._v(" 结束它所处的事务, 或者出现等待超时。")]),s._v(" "),n("h2",{attrs:{id:"删除数据库内数据-保留表结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除数据库内数据-保留表结构"}},[s._v("#")]),s._v(" 删除数据库内数据，保留表结构")]),s._v(" "),n("blockquote",[n("p",[s._v("使用 TRUNCATE 删除")])]),s._v(" "),n("ol",[n("li",[s._v("生成 TRUNCATE 语句")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 禁用外键检查，以避免因外键约束而导致的错误")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" FOREIGN_KEY_CHECKS "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 遍历所有表并执行 TRUNCATE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 用于生成 SQL 语句的查询")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" CONCAT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TRUNCATE TABLE '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" table_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("';'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" information_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" table_schema "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<your_database_name>'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 重新启用外键检查")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" FOREIGN_KEY_CHECKS "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("复制并执行生成的 TRUNCATE 语句，并执行")])])])}),[],!1,null,null,null);n.default=t.exports}}]);