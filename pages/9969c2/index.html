<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>thread | Jacky&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="勤学如春起之苗, 不见其增, 日有所长；辍学如磨刀之石, 不见其损, 日有所亏。">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/blogPages/assets/css/0.styles.83b5fbe5.css" as="style"><link rel="preload" href="/blogPages/assets/js/app.7e06e929.js" as="script"><link rel="preload" href="/blogPages/assets/js/2.ce95ee6e.js" as="script"><link rel="preload" href="/blogPages/assets/js/98.ae9203a0.js" as="script"><link rel="preload" href="/blogPages/assets/js/6.69b19f48.js" as="script"><link rel="prefetch" href="/blogPages/assets/js/10.effd2b33.js"><link rel="prefetch" href="/blogPages/assets/js/100.856fcc53.js"><link rel="prefetch" href="/blogPages/assets/js/101.2fe04807.js"><link rel="prefetch" href="/blogPages/assets/js/102.a570fe0b.js"><link rel="prefetch" href="/blogPages/assets/js/103.00546020.js"><link rel="prefetch" href="/blogPages/assets/js/104.d78b38da.js"><link rel="prefetch" href="/blogPages/assets/js/105.8feb4296.js"><link rel="prefetch" href="/blogPages/assets/js/106.e16f62e7.js"><link rel="prefetch" href="/blogPages/assets/js/107.1750545e.js"><link rel="prefetch" href="/blogPages/assets/js/108.cb3ca371.js"><link rel="prefetch" href="/blogPages/assets/js/109.e6ef1c19.js"><link rel="prefetch" href="/blogPages/assets/js/11.713c286e.js"><link rel="prefetch" href="/blogPages/assets/js/110.38b88640.js"><link rel="prefetch" href="/blogPages/assets/js/111.546521ea.js"><link rel="prefetch" href="/blogPages/assets/js/112.6b0ef40e.js"><link rel="prefetch" href="/blogPages/assets/js/113.8b689694.js"><link rel="prefetch" href="/blogPages/assets/js/114.efb0d75d.js"><link rel="prefetch" href="/blogPages/assets/js/115.b3450440.js"><link rel="prefetch" href="/blogPages/assets/js/116.59a8a82a.js"><link rel="prefetch" href="/blogPages/assets/js/117.a9e3d4c3.js"><link rel="prefetch" href="/blogPages/assets/js/118.1958ce33.js"><link rel="prefetch" href="/blogPages/assets/js/119.405c1672.js"><link rel="prefetch" href="/blogPages/assets/js/12.2815f35b.js"><link rel="prefetch" href="/blogPages/assets/js/120.e2740dd1.js"><link rel="prefetch" href="/blogPages/assets/js/121.0aa78c4e.js"><link rel="prefetch" href="/blogPages/assets/js/122.7fe22975.js"><link rel="prefetch" href="/blogPages/assets/js/123.7e9ba265.js"><link rel="prefetch" href="/blogPages/assets/js/124.de810087.js"><link rel="prefetch" href="/blogPages/assets/js/125.de7aba6e.js"><link rel="prefetch" href="/blogPages/assets/js/126.b8d307f4.js"><link rel="prefetch" href="/blogPages/assets/js/127.b944c6bd.js"><link rel="prefetch" href="/blogPages/assets/js/128.d9fbd218.js"><link rel="prefetch" href="/blogPages/assets/js/129.9f32686a.js"><link rel="prefetch" href="/blogPages/assets/js/13.d27b9fe5.js"><link rel="prefetch" href="/blogPages/assets/js/130.4234001e.js"><link rel="prefetch" href="/blogPages/assets/js/131.5fbc5fd4.js"><link rel="prefetch" href="/blogPages/assets/js/132.6e85e726.js"><link rel="prefetch" href="/blogPages/assets/js/133.1b9b2012.js"><link rel="prefetch" href="/blogPages/assets/js/134.ddd33937.js"><link rel="prefetch" href="/blogPages/assets/js/135.cb7a50a2.js"><link rel="prefetch" href="/blogPages/assets/js/136.db91a988.js"><link rel="prefetch" href="/blogPages/assets/js/137.f31a522d.js"><link rel="prefetch" href="/blogPages/assets/js/138.367e06be.js"><link rel="prefetch" href="/blogPages/assets/js/139.769ea4af.js"><link rel="prefetch" href="/blogPages/assets/js/14.fdde4a68.js"><link rel="prefetch" href="/blogPages/assets/js/140.2ee3edb4.js"><link rel="prefetch" href="/blogPages/assets/js/141.1244633c.js"><link rel="prefetch" href="/blogPages/assets/js/142.66c748b7.js"><link rel="prefetch" href="/blogPages/assets/js/143.24875298.js"><link rel="prefetch" href="/blogPages/assets/js/144.9812ea81.js"><link rel="prefetch" href="/blogPages/assets/js/145.acd0069a.js"><link rel="prefetch" href="/blogPages/assets/js/146.39ce1178.js"><link rel="prefetch" href="/blogPages/assets/js/147.8272cac5.js"><link rel="prefetch" href="/blogPages/assets/js/148.b96b2996.js"><link rel="prefetch" href="/blogPages/assets/js/149.d150cff8.js"><link rel="prefetch" href="/blogPages/assets/js/15.222f035d.js"><link rel="prefetch" href="/blogPages/assets/js/150.50288e9f.js"><link rel="prefetch" href="/blogPages/assets/js/151.0eb10e98.js"><link rel="prefetch" href="/blogPages/assets/js/152.b01dd6dc.js"><link rel="prefetch" href="/blogPages/assets/js/153.5bbdea0d.js"><link rel="prefetch" href="/blogPages/assets/js/154.c2893844.js"><link rel="prefetch" href="/blogPages/assets/js/155.b4853cfe.js"><link rel="prefetch" href="/blogPages/assets/js/156.3a320751.js"><link rel="prefetch" href="/blogPages/assets/js/157.2a6c017a.js"><link rel="prefetch" href="/blogPages/assets/js/158.a526bc4b.js"><link rel="prefetch" href="/blogPages/assets/js/159.0fa12b9e.js"><link rel="prefetch" href="/blogPages/assets/js/16.32123a80.js"><link rel="prefetch" href="/blogPages/assets/js/160.794a2fab.js"><link rel="prefetch" href="/blogPages/assets/js/161.37ca7986.js"><link rel="prefetch" href="/blogPages/assets/js/162.f326722e.js"><link rel="prefetch" href="/blogPages/assets/js/163.713a7700.js"><link rel="prefetch" href="/blogPages/assets/js/164.bf9a07e3.js"><link rel="prefetch" href="/blogPages/assets/js/165.7daed5e5.js"><link rel="prefetch" href="/blogPages/assets/js/166.d60901fe.js"><link rel="prefetch" href="/blogPages/assets/js/167.1db96ae6.js"><link rel="prefetch" href="/blogPages/assets/js/168.06a6de79.js"><link rel="prefetch" href="/blogPages/assets/js/169.b28e42a7.js"><link rel="prefetch" href="/blogPages/assets/js/17.80f38037.js"><link rel="prefetch" href="/blogPages/assets/js/170.5e2b19ac.js"><link rel="prefetch" href="/blogPages/assets/js/171.90db8586.js"><link rel="prefetch" href="/blogPages/assets/js/172.cc24f14b.js"><link rel="prefetch" href="/blogPages/assets/js/173.fe9a6f35.js"><link rel="prefetch" href="/blogPages/assets/js/174.374b8ab4.js"><link rel="prefetch" href="/blogPages/assets/js/175.096a945e.js"><link rel="prefetch" href="/blogPages/assets/js/176.284db50d.js"><link rel="prefetch" href="/blogPages/assets/js/177.6e9e60bf.js"><link rel="prefetch" href="/blogPages/assets/js/178.48bedc23.js"><link rel="prefetch" href="/blogPages/assets/js/179.c2841c5f.js"><link rel="prefetch" href="/blogPages/assets/js/18.a934f28e.js"><link rel="prefetch" href="/blogPages/assets/js/180.832ec21f.js"><link rel="prefetch" href="/blogPages/assets/js/181.edf08aa8.js"><link rel="prefetch" href="/blogPages/assets/js/182.24f1be2e.js"><link rel="prefetch" href="/blogPages/assets/js/183.52a67e98.js"><link rel="prefetch" href="/blogPages/assets/js/184.c5b66db2.js"><link rel="prefetch" href="/blogPages/assets/js/185.1530ae0c.js"><link rel="prefetch" href="/blogPages/assets/js/186.fff99cfa.js"><link rel="prefetch" href="/blogPages/assets/js/187.33cf6355.js"><link rel="prefetch" href="/blogPages/assets/js/188.2bee451f.js"><link rel="prefetch" href="/blogPages/assets/js/189.9ad6c9bc.js"><link rel="prefetch" href="/blogPages/assets/js/19.afa8e383.js"><link rel="prefetch" href="/blogPages/assets/js/190.e09ec135.js"><link rel="prefetch" href="/blogPages/assets/js/191.e442adbb.js"><link rel="prefetch" href="/blogPages/assets/js/192.1d52114b.js"><link rel="prefetch" href="/blogPages/assets/js/193.dd17e4c6.js"><link rel="prefetch" href="/blogPages/assets/js/194.807a9f9b.js"><link rel="prefetch" href="/blogPages/assets/js/195.714e39d4.js"><link rel="prefetch" href="/blogPages/assets/js/196.dec82a34.js"><link rel="prefetch" href="/blogPages/assets/js/197.2ae1eb8f.js"><link rel="prefetch" href="/blogPages/assets/js/198.a118e965.js"><link rel="prefetch" href="/blogPages/assets/js/199.b9ee0287.js"><link rel="prefetch" href="/blogPages/assets/js/20.6d521f87.js"><link rel="prefetch" href="/blogPages/assets/js/200.43ba144f.js"><link rel="prefetch" href="/blogPages/assets/js/201.367b7a45.js"><link rel="prefetch" href="/blogPages/assets/js/202.38830093.js"><link rel="prefetch" href="/blogPages/assets/js/203.a2f798c8.js"><link rel="prefetch" href="/blogPages/assets/js/204.b6ea19da.js"><link rel="prefetch" href="/blogPages/assets/js/205.db88bf4e.js"><link rel="prefetch" href="/blogPages/assets/js/206.7e6160bd.js"><link rel="prefetch" href="/blogPages/assets/js/207.689001c6.js"><link rel="prefetch" href="/blogPages/assets/js/208.f95afd68.js"><link rel="prefetch" href="/blogPages/assets/js/209.52968bd5.js"><link rel="prefetch" href="/blogPages/assets/js/21.891edb5e.js"><link rel="prefetch" href="/blogPages/assets/js/210.81ce8c94.js"><link rel="prefetch" href="/blogPages/assets/js/211.10b3d3a1.js"><link rel="prefetch" href="/blogPages/assets/js/212.b59c8e05.js"><link rel="prefetch" href="/blogPages/assets/js/213.4f466de5.js"><link rel="prefetch" href="/blogPages/assets/js/214.79e0d90a.js"><link rel="prefetch" href="/blogPages/assets/js/215.be04d383.js"><link rel="prefetch" href="/blogPages/assets/js/216.30ed7240.js"><link rel="prefetch" href="/blogPages/assets/js/217.dc1e844c.js"><link rel="prefetch" href="/blogPages/assets/js/218.8b529da0.js"><link rel="prefetch" href="/blogPages/assets/js/219.bdfd22ce.js"><link rel="prefetch" href="/blogPages/assets/js/22.9cefb9ed.js"><link rel="prefetch" href="/blogPages/assets/js/220.cd2d6b20.js"><link rel="prefetch" href="/blogPages/assets/js/221.e378215e.js"><link rel="prefetch" href="/blogPages/assets/js/222.96f337e3.js"><link rel="prefetch" href="/blogPages/assets/js/223.10e37547.js"><link rel="prefetch" href="/blogPages/assets/js/224.6613fa26.js"><link rel="prefetch" href="/blogPages/assets/js/225.e8de9e4b.js"><link rel="prefetch" href="/blogPages/assets/js/226.52cf7a7e.js"><link rel="prefetch" href="/blogPages/assets/js/227.6e1150c5.js"><link rel="prefetch" href="/blogPages/assets/js/228.59195d3c.js"><link rel="prefetch" href="/blogPages/assets/js/229.7a8af49b.js"><link rel="prefetch" href="/blogPages/assets/js/23.3e7db05d.js"><link rel="prefetch" href="/blogPages/assets/js/230.b59e7082.js"><link rel="prefetch" href="/blogPages/assets/js/231.c7b11961.js"><link rel="prefetch" href="/blogPages/assets/js/232.4d615f62.js"><link rel="prefetch" href="/blogPages/assets/js/233.322e6a38.js"><link rel="prefetch" href="/blogPages/assets/js/234.f726741a.js"><link rel="prefetch" href="/blogPages/assets/js/235.2d2fc6b7.js"><link rel="prefetch" href="/blogPages/assets/js/236.b0765fb6.js"><link rel="prefetch" href="/blogPages/assets/js/237.b522514f.js"><link rel="prefetch" href="/blogPages/assets/js/238.b0a10949.js"><link rel="prefetch" href="/blogPages/assets/js/239.e05cd6f7.js"><link rel="prefetch" href="/blogPages/assets/js/24.09089cf2.js"><link rel="prefetch" href="/blogPages/assets/js/240.8017efae.js"><link rel="prefetch" href="/blogPages/assets/js/241.a647dc00.js"><link rel="prefetch" href="/blogPages/assets/js/242.a39755a2.js"><link rel="prefetch" href="/blogPages/assets/js/243.f22cc879.js"><link rel="prefetch" href="/blogPages/assets/js/244.0251a355.js"><link rel="prefetch" href="/blogPages/assets/js/245.030f97d6.js"><link rel="prefetch" href="/blogPages/assets/js/246.eb65f86c.js"><link rel="prefetch" href="/blogPages/assets/js/247.83f1228a.js"><link rel="prefetch" href="/blogPages/assets/js/248.8baf02b9.js"><link rel="prefetch" href="/blogPages/assets/js/249.c12ad9dd.js"><link rel="prefetch" href="/blogPages/assets/js/25.1dcde82e.js"><link rel="prefetch" href="/blogPages/assets/js/250.1e367ae0.js"><link rel="prefetch" href="/blogPages/assets/js/251.cd3b8b6c.js"><link rel="prefetch" href="/blogPages/assets/js/252.c1d9e95b.js"><link rel="prefetch" href="/blogPages/assets/js/253.0f3b2b2b.js"><link rel="prefetch" href="/blogPages/assets/js/254.1300bf58.js"><link rel="prefetch" href="/blogPages/assets/js/255.e71e8fd1.js"><link rel="prefetch" href="/blogPages/assets/js/256.a781b878.js"><link rel="prefetch" href="/blogPages/assets/js/257.6047bce5.js"><link rel="prefetch" href="/blogPages/assets/js/258.2b75ca4f.js"><link rel="prefetch" href="/blogPages/assets/js/259.3dac3542.js"><link rel="prefetch" href="/blogPages/assets/js/26.442a5284.js"><link rel="prefetch" href="/blogPages/assets/js/260.4f015c64.js"><link rel="prefetch" href="/blogPages/assets/js/261.bbd6a104.js"><link rel="prefetch" href="/blogPages/assets/js/262.543e9a41.js"><link rel="prefetch" href="/blogPages/assets/js/263.45578d1f.js"><link rel="prefetch" href="/blogPages/assets/js/264.961c7815.js"><link rel="prefetch" href="/blogPages/assets/js/265.393c48e3.js"><link rel="prefetch" href="/blogPages/assets/js/266.6a246b1d.js"><link rel="prefetch" href="/blogPages/assets/js/267.5ead7519.js"><link rel="prefetch" href="/blogPages/assets/js/268.ac8f322a.js"><link rel="prefetch" href="/blogPages/assets/js/269.2c7ceab6.js"><link rel="prefetch" href="/blogPages/assets/js/27.1a40b968.js"><link rel="prefetch" href="/blogPages/assets/js/270.0574c03d.js"><link rel="prefetch" href="/blogPages/assets/js/271.f1659e2f.js"><link rel="prefetch" href="/blogPages/assets/js/272.eb2050fc.js"><link rel="prefetch" href="/blogPages/assets/js/273.354a789a.js"><link rel="prefetch" href="/blogPages/assets/js/274.1228e133.js"><link rel="prefetch" href="/blogPages/assets/js/275.394c4ec9.js"><link rel="prefetch" href="/blogPages/assets/js/276.65895377.js"><link rel="prefetch" href="/blogPages/assets/js/277.7839383e.js"><link rel="prefetch" href="/blogPages/assets/js/28.865d52b2.js"><link rel="prefetch" href="/blogPages/assets/js/29.8acf9431.js"><link rel="prefetch" href="/blogPages/assets/js/3.42b83bd2.js"><link rel="prefetch" href="/blogPages/assets/js/30.94f1b647.js"><link rel="prefetch" href="/blogPages/assets/js/31.708ebdf9.js"><link rel="prefetch" href="/blogPages/assets/js/32.7f03de55.js"><link rel="prefetch" href="/blogPages/assets/js/33.4f017467.js"><link rel="prefetch" href="/blogPages/assets/js/34.f5c2f907.js"><link rel="prefetch" href="/blogPages/assets/js/35.aa001f48.js"><link rel="prefetch" href="/blogPages/assets/js/36.eb60c85a.js"><link rel="prefetch" href="/blogPages/assets/js/37.e31fbe86.js"><link rel="prefetch" href="/blogPages/assets/js/38.952a3c65.js"><link rel="prefetch" href="/blogPages/assets/js/39.fa701de3.js"><link rel="prefetch" href="/blogPages/assets/js/4.cad3a178.js"><link rel="prefetch" href="/blogPages/assets/js/40.f1146ac7.js"><link rel="prefetch" href="/blogPages/assets/js/41.b41b1524.js"><link rel="prefetch" href="/blogPages/assets/js/42.67e51ac3.js"><link rel="prefetch" href="/blogPages/assets/js/43.5b8ee8b1.js"><link rel="prefetch" href="/blogPages/assets/js/44.7a2933f9.js"><link rel="prefetch" href="/blogPages/assets/js/45.43eca009.js"><link rel="prefetch" href="/blogPages/assets/js/46.8b17b531.js"><link rel="prefetch" href="/blogPages/assets/js/47.51f3b902.js"><link rel="prefetch" href="/blogPages/assets/js/48.dcdcecdf.js"><link rel="prefetch" href="/blogPages/assets/js/49.7ebd93d4.js"><link rel="prefetch" href="/blogPages/assets/js/5.9b78ed29.js"><link rel="prefetch" href="/blogPages/assets/js/50.bc20668e.js"><link rel="prefetch" href="/blogPages/assets/js/51.f624689e.js"><link rel="prefetch" href="/blogPages/assets/js/52.32587c4c.js"><link rel="prefetch" href="/blogPages/assets/js/53.9597d1d9.js"><link rel="prefetch" href="/blogPages/assets/js/54.ebbd8840.js"><link rel="prefetch" href="/blogPages/assets/js/55.216003cc.js"><link rel="prefetch" href="/blogPages/assets/js/56.d8aa6c5c.js"><link rel="prefetch" href="/blogPages/assets/js/57.d6b75d95.js"><link rel="prefetch" href="/blogPages/assets/js/58.c26ae01e.js"><link rel="prefetch" href="/blogPages/assets/js/59.2e9430c6.js"><link rel="prefetch" href="/blogPages/assets/js/60.d0b4f988.js"><link rel="prefetch" href="/blogPages/assets/js/61.56295b49.js"><link rel="prefetch" href="/blogPages/assets/js/62.a80cb665.js"><link rel="prefetch" href="/blogPages/assets/js/63.6fc0066e.js"><link rel="prefetch" href="/blogPages/assets/js/64.40c9dcdc.js"><link rel="prefetch" href="/blogPages/assets/js/65.ea35b2e8.js"><link rel="prefetch" href="/blogPages/assets/js/66.2b77f97d.js"><link rel="prefetch" href="/blogPages/assets/js/67.ce376cf5.js"><link rel="prefetch" href="/blogPages/assets/js/68.588eaf51.js"><link rel="prefetch" href="/blogPages/assets/js/69.bb1ef415.js"><link rel="prefetch" href="/blogPages/assets/js/7.0e22bc5e.js"><link rel="prefetch" href="/blogPages/assets/js/70.8fc3bef9.js"><link rel="prefetch" href="/blogPages/assets/js/71.e445ff46.js"><link rel="prefetch" href="/blogPages/assets/js/72.51a05da1.js"><link rel="prefetch" href="/blogPages/assets/js/73.3e9b6a2b.js"><link rel="prefetch" href="/blogPages/assets/js/74.3719d2db.js"><link rel="prefetch" href="/blogPages/assets/js/75.74255ca6.js"><link rel="prefetch" href="/blogPages/assets/js/76.1b43e06f.js"><link rel="prefetch" href="/blogPages/assets/js/77.1fd95d8f.js"><link rel="prefetch" href="/blogPages/assets/js/78.7c73f45b.js"><link rel="prefetch" href="/blogPages/assets/js/79.a31c58be.js"><link rel="prefetch" href="/blogPages/assets/js/8.5fb41da7.js"><link rel="prefetch" href="/blogPages/assets/js/80.92e6bf0a.js"><link rel="prefetch" href="/blogPages/assets/js/81.84f5f558.js"><link rel="prefetch" href="/blogPages/assets/js/82.4ad9f313.js"><link rel="prefetch" href="/blogPages/assets/js/83.d767f201.js"><link rel="prefetch" href="/blogPages/assets/js/84.f85a0682.js"><link rel="prefetch" href="/blogPages/assets/js/85.d23f3225.js"><link rel="prefetch" href="/blogPages/assets/js/86.d30659c0.js"><link rel="prefetch" href="/blogPages/assets/js/87.060b5818.js"><link rel="prefetch" href="/blogPages/assets/js/88.391b0507.js"><link rel="prefetch" href="/blogPages/assets/js/89.f5f35918.js"><link rel="prefetch" href="/blogPages/assets/js/9.a45a02f8.js"><link rel="prefetch" href="/blogPages/assets/js/90.f6afb3ec.js"><link rel="prefetch" href="/blogPages/assets/js/91.9028eb49.js"><link rel="prefetch" href="/blogPages/assets/js/92.4607a108.js"><link rel="prefetch" href="/blogPages/assets/js/93.780c6d79.js"><link rel="prefetch" href="/blogPages/assets/js/94.11ed27dd.js"><link rel="prefetch" href="/blogPages/assets/js/95.dc3ecec1.js"><link rel="prefetch" href="/blogPages/assets/js/96.440f5259.js"><link rel="prefetch" href="/blogPages/assets/js/97.e43387fc.js"><link rel="prefetch" href="/blogPages/assets/js/99.853784cd.js">
    <link rel="stylesheet" href="/blogPages/assets/css/0.styles.83b5fbe5.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogPages/" class="home-link router-link-active"><!----> <span class="site-name">Jacky's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogPages/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/blogPages/fe/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogPages/web/" class="nav-link">web</a></li><li class="dropdown-subitem"><a href="/blogPages/android/" class="nav-link">android</a></li><li class="dropdown-subitem"><a href="/blogPages/iOS/" class="nav-link">iOS</a></li><li class="dropdown-subitem"><a href="/blogPages/vue/" class="nav-link">vue</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/blogPages/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogPages/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/blogPages/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/blogPages/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/blogPages/pages/5a96b7/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/blogPages/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogPages/tool/" class="nav-link">tool</a></li><li class="dropdown-item"><!----> <a href="/blogPages/algo/" class="nav-link">algo</a></li><li class="dropdown-item"><!----> <a href="/blogPages/python/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/blogPages/java/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/blogPages/server/" class="nav-link">server</a></li><li class="dropdown-item"><!----> <a href="/blogPages/growth/" class="nav-link">growth</a></li><li class="dropdown-item"><!----> <a href="/blogPages/pages/0fe5d6/" class="nav-link">frida</a></li><li class="dropdown-item"><!----> <a href="/blogPages/blog/" class="nav-link">blog</a></li><li class="dropdown-item"><!----> <a href="/blogPages/sp/" class="nav-link">SP</a></li><li class="dropdown-item"><!----> <a href="/blogPages/more/" class="nav-link">more</a></li></ul></div></div> <a href="https://github.com/jacky1234" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://raw.githubusercontent.com/jacky1234/picArchieve/master/uPic/dUmDI0.jpg"> <div class="blogger-info"><h3>Jack Yang</h3> <span>编程; 随笔</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blogPages/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/blogPages/fe/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blogPages/web/" class="nav-link">web</a></li><li class="dropdown-subitem"><a href="/blogPages/android/" class="nav-link">android</a></li><li class="dropdown-subitem"><a href="/blogPages/iOS/" class="nav-link">iOS</a></li><li class="dropdown-subitem"><a href="/blogPages/vue/" class="nav-link">vue</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/blogPages/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogPages/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/blogPages/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/blogPages/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/blogPages/pages/5a96b7/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/blogPages/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogPages/tool/" class="nav-link">tool</a></li><li class="dropdown-item"><!----> <a href="/blogPages/algo/" class="nav-link">algo</a></li><li class="dropdown-item"><!----> <a href="/blogPages/python/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/blogPages/java/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/blogPages/server/" class="nav-link">server</a></li><li class="dropdown-item"><!----> <a href="/blogPages/growth/" class="nav-link">growth</a></li><li class="dropdown-item"><!----> <a href="/blogPages/pages/0fe5d6/" class="nav-link">frida</a></li><li class="dropdown-item"><!----> <a href="/blogPages/blog/" class="nav-link">blog</a></li><li class="dropdown-item"><!----> <a href="/blogPages/sp/" class="nav-link">SP</a></li><li class="dropdown-item"><!----> <a href="/blogPages/more/" class="nav-link">more</a></li></ul></div></div> <a href="https://github.com/jacky1234" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>tool</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>algo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>compute_base</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>blog</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>growth</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>java</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogPages/pages/c38a8f/" class="sidebar-link">java base</a></li><li><a href="/blogPages/pages/d0fce6/" class="sidebar-link">java interview</a></li><li><a href="/blogPages/pages/942dba/" class="sidebar-link">泛型擦除</a></li><li><a href="/blogPages/pages/9969c2/" aria-current="page" class="active sidebar-link">thread</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/blogPages/pages/9969c2/#线程状态" class="sidebar-link">线程状态</a></li><li class="sidebar-sub-header level2"><a href="/blogPages/pages/9969c2/#jvm内存模型" class="sidebar-link">jvm内存模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#jmm-的关键概念" class="sidebar-link">JMM 的关键概念</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#jmm-中的常见问题" class="sidebar-link">JMM 中的常见问题</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#jmm-与-volatile-关键字" class="sidebar-link">JMM 与 volatile 关键字</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#jmm-与-synchronized" class="sidebar-link">JMM 与 synchronized</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blogPages/pages/9969c2/#common-method" class="sidebar-link">common method</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#interrupt" class="sidebar-link">interrupt</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#wait" class="sidebar-link">wait</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#notify-notifyall" class="sidebar-link">notify/notifyAll</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#join" class="sidebar-link">join</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#wait-和-yield-或-sleep-的区别" class="sidebar-link">wait 和 yield(或 sleep)的区别？</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#线程死锁-如何避免线程死锁" class="sidebar-link">线程死锁, 如何避免线程死锁？</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blogPages/pages/9969c2/#同步-异步" class="sidebar-link">同步/异步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#_1-object-的-wait-和-notify-notifyall-synchronized-如何实现线程同步" class="sidebar-link">1.Object 的 wait 和 notify/notifyAll/synchronized 如何实现线程同步？</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#handlerthread" class="sidebar-link">HandlerThread</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#countdownlatch" class="sidebar-link">CountDownLatch</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#semaphore" class="sidebar-link">Semaphore</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#reentrantlock" class="sidebar-link">ReentrantLock</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blogPages/pages/9969c2/#other" class="sidebar-link">other</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#线程池" class="sidebar-link">线程池</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#开启线程" class="sidebar-link">开启线程</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#并发容器" class="sidebar-link">并发容器</a></li><li class="sidebar-sub-header level3"><a href="/blogPages/pages/9969c2/#copyonwrite-容器" class="sidebar-link">CopyOnWrite 容器</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blogPages/pages/9969c2/#link" class="sidebar-link">link</a></li></ul></li><li><a href="/blogPages/pages/7bdb1a/" class="sidebar-link">jvm</a></li><li><a href="/blogPages/pages/c3229c/" class="sidebar-link">UnSafe</a></li><li><a href="/blogPages/pages/55dc87/" class="sidebar-link">collections</a></li><li><a href="/blogPages/pages/ed7a6a/" class="sidebar-link">Class</a></li><li><a href="/blogPages/pages/ee5e8f/" class="sidebar-link">classloader</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C&amp;C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ai</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>secure</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>cms</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>english</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>生活</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>金融学</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>more</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/blogPages/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/blogPages/other/#other" data-v-06225672>other</a></li><li data-v-06225672><a href="/blogPages/other/#java" data-v-06225672>java</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/jacky1234" target="_blank" title="作者" class="beLink" data-v-06225672>Jacky</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-08-13</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">thread<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="线程状态"><a href="#线程状态" class="header-anchor">#</a> 线程状态</h2> <blockquote><p><a href="https://juejin.im/post/5b31b510e51d4558a426f7e9" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5b31b510e51d4558a426f7e9<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/jacky1234/picArchieve@master/uPic/20240913_085647_YKdt01.png" alt=""></p> <ul><li>新状态: 线程对象已经创建, 还没有在其上调用 <code>start()</code> 方法。</li> <li>就绪: 当线程有资格运行, 但调度程序还没有把它选定为运行线程, 这时候线程所处的状态就做就绪状态。当 start()方法调用时, 线程首先进入可运行状态。在线程运行之后或者从阻塞、等待或睡眠状态回来后, 也返回到可运行状态。另外 yield 可以让线程由&quot;运行状态&quot;进入到&quot;就绪状态&quot;。</li> <li>运行: 线程<strong>调度程序从可运行池中选择一个线程来执行</strong>。这也是线程进入运行状态的唯一一种方式。</li> <li>等待/阻塞/睡眠: 这是线程有资格运行时它所处的状态。实际上这个三状态组合为一种, 其共同点是: 线程仍旧是活的, 但是当前没有条件运行。换句话说, <strong>它是可运行的, 但是如果某件事件出现</strong>, 他可能返回到可运行状态。另外 wait 可以让线程由&quot;运行状态&quot;进入到&quot;等待(阻塞)状态&quot;。</li> <li>死亡态: 当线程的 run()方法完成时就认为它死去。这个线程对象也许是活的, 但是, 它已经不是一个单独执行的线程。线程一旦死亡, 就不能复生。 如果在一个死去的线程上调用 start()方法, 会抛出 java.lang.IllegalThreadStateException 异常。</li></ul> <h2 id="jvm内存模型"><a href="#jvm内存模型" class="header-anchor">#</a> jvm内存模型</h2> <blockquote><p>Java 内存模型(Java Memory Model, JMM)是 Java 语言中关于线程如何通过内存进行交互的一套规范。JMM 规定了 Java 程序中变量的读写规则、可见性、原子性和有序性等，并定义了多线程环境下的内存访问行为。它确保了在并发情况下，程序能保持一致性和线程安全性。</p></blockquote> <h3 id="jmm-的关键概念"><a href="#jmm-的关键概念" class="header-anchor">#</a> JMM 的关键概念</h3> <ol><li>主内存与工作内存</li></ol> <ul><li>主内存(Main Memory): 所有线程共享的内存区域。Java 中的所有实例变量(对象字段)和静态变量都存储在主内存中。</li> <li>工作内存(Working Memory): 每个线程都有自己的工作内存，工作内存是线程私有的。线程只能直接访问自己的工作内存。工作内存中的变量是从主内存中拷贝过来的副本。线程对变量的修改首先发生在工作内存中，之后再同步回主内存。</li></ul> <ol start="2"><li>可见性</li></ol> <p>由于线程对变量的读取和写入操作通常是在各自的工作内存中进行的，因此一个线程对变量的更新不一定马上对其他线程可见。JMM 通过 volatile 关键字和锁机制来保证变量的可见性:</p> <ul><li>volatile 变量: 对 volatile 变量的修改会直接写入主内存，读操作也会从主内存中读取，因此 volatile 变量可以保证对其他线程是可见的。</li> <li>同步机制(synchronized、Lock): 加锁和解锁操作会使线程之间的变量修改可见，因为这些操作会刷新工作内存和主内存之间的内容。</li></ul> <ol start="3"><li>原子性</li></ol> <p>原子性是指一个操作不会被线程调度机制打断，保证操作的完整性。JMM 规定了以下操作具有原子性:</p> <ul><li>基本类型的读取和写入(long 和 double 除外，除非使用 volatile)。</li> <li>对 volatile 变量的读取和写入。</li></ul> <p>对于复合操作(如 <code>i++</code>)，它并不具备原子性，需要通过锁或 AtomicInteger 等类来保证原子性。</p> <ol start="4"><li>有序性</li></ol> <p>Java 语言规范允许编译器和处理器对代码进行重排序，以优化性能。虽然重排序在单线程中是无害的，但在多线程环境下可能会导致意外行为。JMM 提供了两种方式来保证线程之间的操作有序性:</p> <ul><li>volatile 关键字: 保证 volatile 变量的读写操作不会被重排序。</li> <li>同步块(synchronized): 在同步块内的操作不会被重排序。</li></ul> <ol start="5"><li>Happens-Before 规则</li></ol> <p>Happens-Before 是 JMM 用来规定操作执行顺序的规则。简单地说，Happens-Before 关系确保了一个操作的结果对另一个操作是可见的。JMM 定义了一些常见的 Happens-Before 关系:</p> <ul><li>线程中的每个操作都 Happens-Before 该线程中的任何后续操作。</li> <li>对一个对象的初始化 Happens-Before 该对象的引用可以被其他线程看到。</li> <li>对 volatile 变量的写入 Happens-Before 该变量的读取。</li> <li>一个线程的 unlock 操作 Happens-Before 另一个线程的 lock 操作。</li></ul> <h3 id="jmm-中的常见问题"><a href="#jmm-中的常见问题" class="header-anchor">#</a> JMM 中的常见问题</h3> <ol><li>可见性问题 由于线程的操作都是在自己的工作内存中进行的，因此线程间可能无法立即看到彼此对变量的修改，导致共享变量的可见性问题。例如，一个线程更新了某个变量的值，另一个线程可能继续看到变量的旧值。</li></ol> <p>解决办法: 使用 volatile 关键字或同步机制来确保变量的可见性。</p> <ol start="2"><li>指令重排序 在编译器和处理器的优化下，代码可能会发生指令重排序。例如，某些代码语句在内存中的执行顺序可能不同于源码中的顺序。虽然单线程程序中这种优化是安全的，但多线程环境下可能会导致一些不符合预期的行为。</li></ol> <p>解决办法: 使用 volatile 或 synchronized 来禁止重排序。</p> <ol start="3"><li>原子性问题 一些非原子操作(如 i++)在多线程环境下可能会导致数据竞争，线程执行时会相互干扰，导致最终的结果不正确。</li></ol> <p>解决办法: 使用 synchronized 或 Java 并发包中的 Atomic 类来保证原子性。</p> <h3 id="jmm-与-volatile-关键字"><a href="#jmm-与-volatile-关键字" class="header-anchor">#</a> JMM 与 volatile 关键字</h3> <ul><li>volatile 的作用: volatile 修饰的变量具有以下两大特性:</li> <li>可见性: 一个线程对 volatile 变量的写入对其他线程是立即可见的。</li> <li>禁止重排序: 对 volatile 变量的读写操作不会与其他内存操作重排序。</li></ul> <p>但是，volatile 不能保证复合操作的原子性。因此，如果需要对 volatile 变量进行复合操作(如 i++)，仍然需要额外的同步机制。</p> <h3 id="jmm-与-synchronized"><a href="#jmm-与-synchronized" class="header-anchor">#</a> JMM 与 synchronized</h3> <p>synchronized 的作用: synchronized 可以确保两个线程对同步代码块的互斥访问，并且通过锁的释放和获取保证了可见性和有序性。即:</p> <ul><li>一个线程释放锁时，它对共享变量的修改会立即对其他获取同一锁的线程可见。</li> <li>进入同步代码块的所有线程都可以看到之前所有对锁的修改操作。</li></ul> <span style="color:green;font-weight:bold;" data-v-35c53164>总结</span> <p>Java 内存模型定义了 Java 程序在并发执行时内存操作的行为，解决了多线程环境下的可见性、原子性和有序性问题。通过 volatile、synchronized 以及 Atomic 类等机制，JMM 保证了线程之间共享数据的一致性，从而使得并发程序能够正确、安全地运行。</p> <h2 id="common-method"><a href="#common-method" class="header-anchor">#</a> common method</h2> <h3 id="interrupt"><a href="#interrupt" class="header-anchor">#</a> interrupt</h3> <p><a href="http://blog.csdn.net/ns_code/article/details/17091267" target="_blank" rel="noopener noreferrer">Java 并发编程 之二: 线程中断<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>注意一下: 待决中断。</p> <p>通常, 我们通过&quot;标记&quot;方式终止处于&quot;运行状态&quot;的线程。其中, 包括&quot;中断标记&quot;和&quot;额外添加标记&quot;。</p> <p>说明: isInterrupted()是判断线程的中断标记是不是为 true。当线程处于运行状态, 并且我们需要终止它时；可以调用线程的 interrupt()方法, 使用线程的中断标记为 true, 即 isInterrupted()会返回 true。此时, 就会退出 while 循环。
注意: <code>interrupt()</code> 并不会终止处于&quot;运行状态&quot;的线程！它会将线程的中断标记设为 true。</p> <span style="color:green;font-weight:bold;" data-v-35c53164>比较通用的终止线程的形式: </span> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. isInterrupted()保证, 只要中断标记为true就终止线程。</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 执行任务...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2. InterruptedException异常保证, 当InterruptedException异常产生时, 线程被终止。</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="wait"><a href="#wait" class="header-anchor">#</a> wait</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">*</span>  <span class="token class-name">The</span> current thread must own <span class="token keyword">this</span> object's <span class="token class-name"><span class="token namespace">monitor<span class="token punctuation">.</span></span> The</span> thread
<span class="token operator">*</span> releases ownership of <span class="token keyword">this</span> monitor and waits until another thread
<span class="token operator">*</span> notifies threads waiting on <span class="token keyword">this</span> object's monitor <span class="token keyword">to</span> <span class="token namespace">wake</span> up
<span class="token operator">*</span> either through a call <span class="token keyword">to</span> <span class="token namespace">the</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@code</span> notify<span class="token punctuation">}</span> method or the
<span class="token operator">*</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@code</span> notifyAll<span class="token punctuation">}</span> <span class="token class-name"><span class="token namespace">method<span class="token punctuation">.</span></span> The</span> thread then waits until it can
<span class="token operator">*</span> re<span class="token operator">-</span>obtain ownership of the monitor and resumes execution<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>wait()</code> 的作用是让当前线程进入等待状态, 同时,让当前线程释放它所持有 object 对象锁。</p> <h3 id="notify-notifyall"><a href="#notify-notifyall" class="header-anchor">#</a> notify/notifyAll</h3> <blockquote><p>Wakes up all threads that are waiting on this object's monitor. A thread waits on an object's monitor by calling one of the {@code wait} methods.
This method should only be called by a thread that is the owner
of this object's monitor.</p></blockquote> <ul><li>唤醒此对象监视器上所有的等待的线程。<span style="color:green;font-weight:bold;" data-v-35c53164>一旦一个对象调用了 wait 方法, 必须要采用 notify()和 notifyAll()方法唤醒该线程</span></li> <li>notify()和 notifyAll()的作用, 则是唤醒在此对象监视器上等待的单个/全部线程。</li></ul> <h3 id="join"><a href="#join" class="header-anchor">#</a> <a href="http://www.cnblogs.com/techyc/p/3286678.html" target="_blank" rel="noopener noreferrer">join<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p><code>join()</code> 方法的作用, 是等待这个线程结束；
<code>t.join()</code> 方法阻塞调用此方法的线程(calling thread), 直到线程 t 完成, 此线程再继续；通常用于在 main()主线程内, 等待其它线程完成再结束 main()主线程。</p> <p>源码中:</p> <p>Join 方法实现是通过 wait(小提示: Object 提供的方法)。 当 main 线程调用 t.join 时候, main 线程会获得线程对象 t 的锁(wait 意味着拿到该对象的锁),调用该对象的 wait(等待时间), 直到该对象唤醒 main 线程 , 比如退出后。这就意味着 main 线程调用 t.join 时, 必须能够拿到线程 t 对象的锁。</p> <h3 id="wait-和-yield-或-sleep-的区别"><a href="#wait-和-yield-或-sleep-的区别" class="header-anchor">#</a> wait 和 yield(或 sleep)的区别？</h3> <blockquote><p>wait()是让线程由&quot;运行状态&quot;进入到&quot;等待(阻塞)状态&quot;
yield()是让线程由&quot;运行状态&quot;进入到&quot;就绪状态&quot;, 从而让其它具有相同优先级的等待线程有机会获取执行权；<strong>但是, 并不能保证在当前线程调用 yield()之后, 其它具有相同优先级的线程就一定能获得执行权。</strong> <strong>wait()是会在线程释放它所持有对象的同步锁, 而 yield()方法不会释放锁。</strong>
Thread.sleep(long millis)和 Thread.sleep(long millis, int nanos)静态方法强制当前正在执行的线程休眠.当线程睡眠时, 它入睡在某个地方, 在苏醒之前不会返回到可运行状态。当睡眠时间到期, 则返回到可运行状态(就绪)。</p></blockquote> <h3 id="线程死锁-如何避免线程死锁"><a href="#线程死锁-如何避免线程死锁" class="header-anchor">#</a> 线程死锁, 如何避免线程死锁？</h3> <ul><li>什么是死锁: 多个线程因竞争资源而造成的一种僵局(互相等待), 若无外力作用, 这些进程都将无法向前推进。</li></ul> <h2 id="同步-异步"><a href="#同步-异步" class="header-anchor">#</a> 同步/异步</h2> <h3 id="_1-object-的-wait-和-notify-notifyall-synchronized-如何实现线程同步"><a href="#_1-object-的-wait-和-notify-notifyall-synchronized-如何实现线程同步" class="header-anchor">#</a> 1.Object 的 wait 和 notify/notifyAll/synchronized 如何实现线程同步？</h3> <p>以 android 中的 HandlerThread (Handy class for starting a new thread that has a looper) 的源码为例说明</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mTid <span class="token operator">=</span> <span class="token class-name">Process</span><span class="token punctuation">.</span><span class="token function">myTid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/**
         * 获取到当前Thread的Looper对象
         * 然后通知 getLooper 方法, 这个时候可以返回(同步)
         */</span>
        mLooper <span class="token operator">=</span> <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">myLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Process</span><span class="token punctuation">.</span><span class="token function">setThreadPriority</span><span class="token punctuation">(</span>mPriority<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onLooperPrepared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mTid <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">Looper</span> <span class="token function">getLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// If the thread has been started, wait until the looper has been created.</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mLooper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">/**
                 * 等待run方法的Looper对象初始化完成
                 */</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> mLooper<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>再比如<a href="https://github.com/ximsfei/Android-skin-support#%E5%BA%94%E7%94%A8%E5%86%85%E6%8D%A2%E8%82%A4" target="_blank" rel="noopener noreferrer">换肤框架 Android-skin-support<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中 loadSkin 使用了的同步示例:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> mLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">AsyncTask</span> <span class="token function">loadSkin</span><span class="token punctuation">(</span><span class="token class-name">String</span> skinName<span class="token punctuation">,</span> <span class="token class-name">SkinLoaderListener</span> listener<span class="token punctuation">,</span> <span class="token keyword">int</span> strategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SkinLoadTask</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> mStrategyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>skinName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">SkinLoadTask</span> <span class="token keyword">extends</span> <span class="token class-name">AsyncTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Void</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SkinLoaderListener</span> mListener<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SkinLoaderStrategy</span> mStrategy<span class="token punctuation">;</span>

    <span class="token class-name">SkinLoadTask</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">SkinLoaderListener</span> listener<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">SkinLoaderStrategy</span> strategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mListener <span class="token operator">=</span> listener<span class="token punctuation">;</span>
        mStrategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPreExecute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mListener<span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">doInBackground</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>mLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    mLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            mLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">SkinCompatResources</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>
                        mStrategy<span class="token punctuation">.</span><span class="token function">loadSkinInBackground</span><span class="token punctuation">(</span>mAppContext<span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">SkinCompatResources</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPostExecute</span><span class="token punctuation">(</span><span class="token class-name">String</span> skinName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SkinLog</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;skinName = &quot;</span> <span class="token operator">+</span> skinName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// skinName 为&quot;&quot;时, 恢复默认皮肤</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>skinName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">SkinPreference</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSkinName</span><span class="token punctuation">(</span>skinName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSkinStrategy</span><span class="token punctuation">(</span>mStrategy<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commitEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">notifyUpdateSkin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mListener<span class="token punctuation">.</span><span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">SkinPreference</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSkinName</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSkinStrategy</span><span class="token punctuation">(</span><span class="token constant">SKIN_LOADER_STRATEGY_NONE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commitEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mListener<span class="token punctuation">.</span><span class="token function">onFailed</span><span class="token punctuation">(</span><span class="token string">&quot;皮肤资源获取失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            mLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            mLock<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h3 id="handlerthread"><a href="#handlerthread" class="header-anchor">#</a> HandlerThread</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">HandlerThread</span> thread <span class="token operator">=</span> <span class="token function">newHandlerThread</span><span class="token punctuation">(</span><span class="token string">&quot;handler_thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//必须要调用start方法</span>
<span class="token keyword">final</span> <span class="token class-name">Handlerhandler</span> <span class="token operator">=</span> <span class="token function">newHandler</span><span class="token punctuation">(</span>thread<span class="token punctuation">.</span><span class="token function">getLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><span style="color:green;font-weight:bold;" data-v-35c53164>main api</span> <ul><li><code>getLooper()</code> : 返回与该线程相关联的Looper对象</li></ul> <h3 id="countdownlatch"><a href="#countdownlatch" class="header-anchor">#</a> CountDownLatch</h3> <p><code>CountDownLatch</code> 是一种灵活的闭锁实现, 包含一个计数器, 该计算器初始化为一个正数, 表示需要等待事件的数量。countDown 方法递减计数器, 表示有一个事件发生, 而 await 方法等待计数器到达 0, 表示所有需要等待的事情都已经完成. 在完成一组正在其他线程中执行的操作之前, 它允许一个或多个线程一直等待。<a href="(http://blog.csdn.net/lmj623565791/article/details/26626391)">link</a></p> <span style="color:green;font-weight:bold;" data-v-35c53164>使用场景</span> <ol><li>例如我们上例中所有人都到达饭店然后吃饭</li> <li>某个操作需要的资源初始化完毕</li> <li>某个服务依赖的线程全部开启等等...</li></ol> <span style="color:green;font-weight:bold;" data-v-35c53164>main api</span> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//构造方法参数指定了计数的次数</span>
<span class="token keyword">public</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//countDown方法, 当前线程调用此方法, 则计数减一</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//awaint方法, 调用此方法会一直阻塞当前线程, 直到计时器的值为0</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="semaphore"><a href="#semaphore" class="header-anchor">#</a> Semaphore</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 允许最多0个线程获取许可</span>
<span class="token keyword">final</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">Boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
fileDecodingQueue<span class="token punctuation">.</span><span class="token function">postRunnable</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">openOpusFile</span><span class="token punctuation">(</span>messageObject<span class="token punctuation">.</span>location<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><span style="color:green;font-weight:bold;" data-v-35c53164>main api</span> <ul><li><code>&lt;init&gt;(count)</code>: 初始许可个数</li> <li><code>acquire()</code>: 请求许可, 如果没有许可, 那么acquire方法将会一直阻塞直到有许可(或者直到被终端或者操作超时)</li> <li><code>release()</code>: 释放许可</li></ul> <span style="color:green;font-weight:bold;" data-v-35c53164>case: 使用信号量机制, 实现互斥访问打印机</span> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MutexPrint</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">PrintCount</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>	<span class="token comment">//打印机的数量</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token class-name">PrintCount</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; enter ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 正在打印 ...&quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; out ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">MutexPrint</span> print <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutexPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        print<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="reentrantlock"><a href="#reentrantlock" class="header-anchor">#</a> ReentrantLock</h3> <blockquote><p><a href="http://uule.iteye.com/blog/1488356" target="_blank" rel="noopener noreferrer">可重入锁, 互斥锁<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 用法参照 LinkedBlockingQueue 源码实现</p></blockquote> <ul><li>重入性: 指的是同一个线程多次试图获取它所占有的锁, 请求会成功。当释放锁的时候, 直到重入次数清零, 锁才释放完毕。</li></ul> <p>ReentrantLock 将由最近成功获得锁, 并且还没有释放该锁的线程所拥有。如果当前线程已经拥有该锁, 此方法将立即返回。可以使用 isHeldByCurrentThread() 和 getHoldCount() 方法来检查此情况是否发生。
此类的构造方法接受一个可选的公平 参数。当设置为 true 时, 在多个线程的争用下, 这些锁倾向于将访问权授予等待时间最长的线程。否则此锁将无法保证任何特定访问顺序。与采用默认设置(使用不公平锁)相比, 使用公平锁的程序在许多线程访问时表现为很低的总体吞吐量(即速度很慢, 常常极其慢), 但是在获得锁和保证锁分配的均衡性时差异较小。不过要注意的是, 公平锁不能保证线程调度的公平性。因此, 使用公平锁的众多线程中的一员可能获得多倍的成功机会, 这种情况发生在其他活动线程没有被处理并且目前并未持有锁时。还要注意的是, 未定时的 tryLock 方法并没有使用公平设置。因为即使其他线程正在等待, 只要该锁是可用的, 此方法就可以获得成功。</p> <span style="color:green;font-weight:bold;" data-v-35c53164>main api</span> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">// 创建一个自由竞争的可重入锁</span>
<span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span>

lock
unlock
isHeldByCurrentThread
getHoldCount
lockInterruptibly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><span style="color:green;font-weight:bold;" data-v-35c53164>ReentrantLock vs synchronized </span> <p>**不同: **
1.ReentrantLock 功能性方面更全面, 比如时间锁等候, 可中断锁等候, 锁投票等, 因此更有扩展性。在多个条件变量和高度竞争锁的地方, 用 ReentrantLock 更合适, ReentrantLock 还提供了 Condition, 对线程的等待和唤醒等操作更加灵活, 一个 ReentrantLock 可以有多个 Condition 实例, 所以更有扩展性。
2.ReentrantLock 必须在 finally 中释放锁, 否则后果很严重, 编码角度来说使用 synchronized 更加简单, 不容易遗漏或者出错。
3.ReentrantLock 的性能比 synchronized 会好点。
4.ReentrantLock 提供了可轮询的锁请求, 他可以尝试的去取得锁, 如果取得成功则继续处理, 取得不成功, 可以等下次运行的时候处理, 所以不容易产生死锁, 而 synchronized 则一旦进入锁请求要么成功, 要么一直阻塞, 所以更容易产生死锁。</p> <ol><li>Lock 的某些方法可以决定多长时间内尝试获取锁, 如果获取不到就抛异常, 这样就可以一定程度上减轻死锁的可能性。
如果锁被另一个线程占据了, synchronized 只会一直等待, 很容易错序死锁</li> <li>synchronized 的话, 锁的范围是整个方法或 synchronized 块部分；而 Lock 因为是方法调用, 可以跨方法, 灵活性更大</li> <li>便于测试, 单元测试时, 可以模拟 Lock, 确定是否获得了锁, 而 synchronized</li></ol> <h2 id="other"><a href="#other" class="header-anchor">#</a> other</h2> <h3 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h3> <ul><li><a href="http://blog.csdn.net/lmj623565791/article/details/27250059" target="_blank" rel="noopener noreferrer">Java 并发专题 带返回结果的批量任务执行 CompletionService ExecutorService.invokeAll<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.infoq.com/cn/articles/java-threadPool" target="_blank" rel="noopener noreferrer">JAVA 线程池的分析和使用-ThreadPoolExecutor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Java 四种线程池的使用</p> <blockquote><p><a href="http://cuisuqiang.iteye.com/blog/2019372" target="_blank" rel="noopener noreferrer">link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li>newCachedThreadPool 创建一个可缓存线程池, 如果线程池长度超过处理需要, 可灵活回收空闲线程, 若无可回收, 则新建线程。</li> <li>newFixedThreadPool 创建一个定长线程池, 可控制线程最大并发数, 超出的线程会在队列中等待。</li> <li>newScheduledThreadPool 创建一个定长线程池, 支持定时及周期性任务执行。</li> <li>newSingleThreadExecutor 创建一个单线程化的线程池, 它只会用唯一的工作线程来执行任务, 保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行。</li></ul> <h3 id="开启线程"><a href="#开启线程" class="header-anchor">#</a> 开启线程</h3> <ul><li><a href="http://blog.csdn.net/longshengguoji/article/details/41126119" target="_blank" rel="noopener noreferrer">开启线程的三种方式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="并发容器"><a href="#并发容器" class="header-anchor">#</a> 并发容器</h3> <ul><li><p><a href="http://www.cnblogs.com/jackyuj/archive/2010/11/24/1886553.html" target="_blank" rel="noopener noreferrer">工具篇-BlockingQueue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://www.cnblogs.com/CarpenterLee/p/5468803.html" target="_blank" rel="noopener noreferrer">Java ArrayDeque 源码剖析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://cakin24.iteye.com/blog/2324030" target="_blank" rel="noopener noreferrer">ArrayDeque 集合的妙用,栈；队列<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>ConcurrentHashMap</p></li> <li><p>ConcurrentLinkedDeque</p></li> <li><p>LinkedBlockingDeque 并发</p></li> <li><p>CopyOnWriteArrayList</p></li></ul> <span style="color:green;font-weight:bold;" data-v-35c53164>接口</span> <ul><li>Queue</li> <li>Deque</li> <li>BlockingDeque</li></ul> <h3 id="copyonwrite-容器"><a href="#copyonwrite-容器" class="header-anchor">#</a> CopyOnWrite 容器</h3> <blockquote><p>CopyOnWrite 容器即写时复制的容器。通俗的理解是当我们往一个容器添加元素的时候, 不直接往当前容器添加, 而是先将当前容器进行 Copy, 复制出一个新的容器, 然后新的容器里添加元素, 添加完元素之后, 再将原容器的引用指向新的容器。这样做的好处是我们可以对 CopyOnWrite 容器进行并发的读, 而不需要加锁, 因为当前容器不会添加任何元素。所以<span style="color:green;font-weight:bold;" data-v-35c53164>CopyOnWrite 容器也是一种读写分离的思想, 读和写不同的容器</span>.</p></blockquote> <span style="color:green;font-weight:bold;" data-v-35c53164>应用场景</span> <p>CopyOnWrite 并发容器用于读多写少的并发场景。比如白名单, 黑名单, 商品类目的访问和更新场景, 假如我们有一个搜索网站, 用户在这个网站的搜索框中, 输入关键字搜索内容, 但是某些关键字不允许被搜索。这些不能被搜索的关键字会被放在一个黑名单当中, 黑名单每天晚上更新一次。当用户搜索时, 会检查当前关键字在不在黑名单当中, 如果在, 则提示不能搜索。</p> <h2 id="link"><a href="#link" class="header-anchor">#</a> link</h2></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/blogPages/tags/?tag=interview" title="标签">#interview</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/10/24, 14:39:43</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/blogPages/pages/942dba/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">泛型擦除</div></a> <a href="/blogPages/pages/7bdb1a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">jvm</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blogPages/pages/942dba/" class="prev">泛型擦除</a></span> <span class="next"><a href="/blogPages/pages/7bdb1a/">jvm</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/blogPages/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blogPages/pages/9729d0/"><div>
            mac
            <!----></div></a> <span class="date">10-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/blogPages/pages/ae37cb/"><div>
            xargs
            <!----></div></a> <span class="date">10-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/blogPages/pages/f3e095/"><div>
            brew
            <!----></div></a> <span class="date">10-18</span></dt></dl> <dl><dd></dd> <dt><a href="/blogPages/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:jackdoson2011@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/jacky1234" title="Github" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/my/m/music/playlist?id=317363436" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Jacky | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/blogPages/assets/js/app.7e06e929.js" defer></script><script src="/blogPages/assets/js/2.ce95ee6e.js" defer></script><script src="/blogPages/assets/js/98.ae9203a0.js" defer></script><script src="/blogPages/assets/js/6.69b19f48.js" defer></script>
  </body>
</html>
